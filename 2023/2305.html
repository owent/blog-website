<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>å…³äºprotobufè¿‘æœŸç‰ˆæœ¬ï¼ˆv20/v3.20+ï¼‰å’Œ gRPC v1.54ç‰ˆæœ¬åœ¨æŸäº›ç¼–è¯‘ç¯å¢ƒä¸‹çš„ä¸€äº›é“¾æ¥å’Œç¼–è¯‘é—®é¢˜|I'm OWenT</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=canonical href=//owent.net/2023/2305.html><link rel=icon href=/favicon.ico><link rel=stylesheet href=//unpkg.com/bootstrap@latest/dist/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=//owent.net//css/style.css><link rel=stylesheet href=//owent.net/css/syntax.css><script type=importmap>
{
  "imports": {
    "react": "//unpkg.com/react@latest",
    "react-bootstrap": "//unpkg.com/react-bootstrap@latest",
    "mermaid": "//unpkg.com/mermaid@latest/dist/mermaid.esm.min.mjs",
    "bootstrap": "//unpkg.com/bootstrap@latest/dist/js/bootstrap.esm.min.js",
    "@popperjs/core": "//unpkg.com/@popperjs/core@latest/dist/esm/popper.js"
  }
}
</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8180054975285991" crossorigin=anonymous></script><meta content="codeva-4M5iohb9TW" name=baidu-site-verification></head><body><div id=container><div id=wrap><header id=header><div id=banner></div><div id=header-outer><div id=header-title><h1 id=site-title><a href=//owent.net/ id=logo>I'm OWenT</a></h1><h2 id=site-description>Challenge Everything</h2></div><div id=header-inner><nav id=main-nav class="navbar navbar-expand-md navbar-dark"><button class="navbar-toggler navbar-toggler-right" type=button data-bs-toggle=collapse data-bs-target=#main-nav-links aria-controls=main-nav-links aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<a id=main-nav-brand class="navbar-brand collapse" href=#>#</a><div class="collapse navbar-collapse position-relative" id=main-nav-links><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/index.html title=Home>Home</a></li><li class=nav-item><a class=nav-link href=/archives/index.html title=Archives>Archives</a></li><li class=nav-item><a class=nav-link href=/about/index.html title=About>About</a></li></ul><div class="col-12 col-xl-2 col-lg-3 col-md-4" id=main-nav-search><form class=input-group method=get accept-charset=UTF-8 action=//www.bing.com/search><input type=hidden name=q1 value=site:owent.net>
<input class=form-control type=text placeholder=æœç´¢ name=q>
<button class="btn btn-outline-secondary my-0" type=submit>æœç´¢</button></form></div></div></nav></div></div></header><div id=main><section id=main-content><div id=post-content><article id=post-a6fd18406b94bb7e782bc2aac484fe8d class="article-panel article article-type-post" itemscope itemprop=blogPost><div class="article-panel-inner article-inner"><div class=article-inner><header class=article-header><h1 itemprop=name><a class=article-title href=//owent.net/2023/2305.html target=_blank itemprop=url>å…³äºprotobufè¿‘æœŸç‰ˆæœ¬ï¼ˆv20/v3.20+ï¼‰å’Œ gRPC v1.54ç‰ˆæœ¬åœ¨æŸäº›ç¼–è¯‘ç¯å¢ƒä¸‹çš„ä¸€äº›é“¾æ¥å’Œç¼–è¯‘é—®é¢˜</a></h1></header><hr><div id=toc class="well toc m-3 p-1 pr-1 pt-1 pb-2 float-md-right float-md-end"><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#protobuf-çš„é“¾æ¥å’Œç¬¦å·é—®é¢˜><a href=https://github.com/protocolbuffers/protobuf>protobuf</a> çš„é“¾æ¥å’Œç¬¦å·é—®é¢˜</a><ul><li><a href=#internalmetadatainternalmetadata-æœªå®šä¹‰><code>InternalMetadata::~InternalMetadata()</code> æœªå®šä¹‰</a></li><li><a href=#xxx_default_instance_-æœªå®šä¹‰><code>XXX_default_instance_</code> æœªå®šä¹‰</a></li></ul></li><li><a href=#grpc-çš„é“¾æ¥å’Œç¼–è¯‘é—®é¢˜><a href=https://github.com/grpc/grpc>gRPC</a> çš„é“¾æ¥å’Œç¼–è¯‘é—®é¢˜</a><ul><li><a href=#grpc-çš„-v1540-çš„é“¾æ¥ç¬¦å·é—®é¢˜><a href=https://github.com/grpc/grpc>gRPC</a> çš„ v1.54.0 çš„é“¾æ¥ç¬¦å·é—®é¢˜</a></li><li><a href=#grpc-çš„åœ¨éƒ¨åˆ†ç¼–è¯‘å™¨ä¸Šçš„å…¼å®¹æ€§é—®é¢˜><a href=https://github.com/grpc/grpc>gRPC</a> çš„åœ¨éƒ¨åˆ†ç¼–è¯‘å™¨ä¸Šçš„å…¼å®¹æ€§é—®é¢˜</a></li></ul></li><li><a href=#æœ€å>æœ€å</a></li></ul></nav><div class="ads-placeholder ads-container"><ins class="adsbygoogle ads_toc" style=display:block data-ad-client=ca-pub-8180054975285991 data-ad-slot=1249494377 data-ad-format="rectangle, vertical" data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><br><div class=article-entry itemprop=articleBody><h2 id=å‰è¨€>å‰è¨€</h2><p>å¹´åˆçš„æ—¶å€™æˆ‘ä»¬é¡¹ç›®ç»„çš„æ„å»ºç³»ç»Ÿ( <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> )é‡ŒæŠŠ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> å‡çº§åˆ°äº† v20/v3.20 ç‰ˆæœ¬, <a href=https://github.com/grpc/grpc>gRPC</a> ä¹Ÿå‡çº§åˆ°äº† v1.54 ç‰ˆæœ¬ã€‚ç„¶è€Œè¿™ä¸¤ä¸ªç‰ˆæœ¬åœ¨Linuxçš„ELF ABIå’ŒMacOSçš„Macho ABIä¸‹éƒ½å‡ºç°äº†ä¸€äº›ç¬¦å·æœªå®šä¹‰çš„é—®é¢˜ï¼ˆå½“ç„¶ä¹ŸåŒ…å«Androidå’ŒiOSï¼‰ã€‚
è¿™äº›é—®é¢˜ä¹Ÿä¸ä»…é™äº <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v20/v3.20 å’Œ <a href=https://github.com/grpc/grpc>gRPC</a> v1.54ï¼Œåç»­çš„ç‰ˆæœ¬æœ‰äº›ä¿®å¤äº†ï¼Œæœ‰äº›æ²¡æœ‰ã€‚åœ¨å®˜æ–¹å®Œå…¨ä¿®å¤ä¹‹å‰ï¼Œæˆ‘ä»¬è‡ªå·±æ‰“äº†ä¸€äº›patchå»ä¿®å¤è¿™äº›é—®é¢˜ã€‚</p><h2 id=protobuf-çš„é“¾æ¥å’Œç¬¦å·é—®é¢˜><a href=https://github.com/protocolbuffers/protobuf>protobuf</a> çš„é“¾æ¥å’Œç¬¦å·é—®é¢˜</h2><h3 id=internalmetadatainternalmetadata-æœªå®šä¹‰><code>InternalMetadata::~InternalMetadata()</code> æœªå®šä¹‰</h3><p><a href=https://github.com/protocolbuffers/protobuf>protobuf</a>çš„é—®é¢˜ä¸»è¦åˆ†ä¸¤ç»„ï¼Œç¬¬ä¸€ç»„æŠ¥çš„æ˜¯ <code>InternalMetadata::~InternalMetadata()</code> æœªå®šä¹‰ã€‚è¿™ä¸ªé—®é¢˜å­˜åœ¨äº v20/v3.20 å’Œ v21/v3.21 ã€‚v22/v4.22 ç‰ˆæœ¬å·²ä¿®å¤ï¼ˆv22/v4.22åœ¨æ„å»ºå’Œä¾èµ–ä¸Šæœ‰ä¸ªå¾ˆå¤§çš„å˜åŒ–ï¼Œåé¢å†å†™åˆ†äº«è¯´æ˜ï¼‰ã€‚è¿™ä¸ªé—®é¢˜çš„issueä¹Ÿå¯ä»¥è§äº <a href=https://github.com/protocolbuffers/protobuf/issues/9947>https://github.com/protocolbuffers/protobuf/issues/9947</a> ã€‚</p><p>å…¶æœ¬è´¨åŸå› å¯ä»¥å…ˆçœ‹ v20/v3.20 ç‰ˆæœ¬çš„ <a href=https://github.com/protocolbuffers/protobuf/blob/v20.2/src/google/protobuf/metadata_lite.h#L73>metadata_lite.h#L73</a></p><pre><code class=language-cpp>#if defined(NDEBUG) || defined(_MSC_VER)
  ~InternalMetadata() {
    if (HasMessageOwnedArenaTag()) {
      delete reinterpret_cast&lt;Arena*&gt;(ptr_ - kMessageOwnedArenaTagMask);
    }
  }
#else
  ~InternalMetadata();
#endif
</code></pre><p>è¿˜æœ‰æºæ–‡ä»¶ <a href=https://github.com/protocolbuffers/protobuf/blob/v20.2/src/google/protobuf/message_lite.cc#L528>message_lite.cc#L528</a></p><pre><code class=language-cpp>// Non-inline implementations of InternalMetadata routines
#if defined(NDEBUG) || defined(_MSC_VER)
// for opt and MSVC builds, the destructor is defined in the header.
#else
// This is moved out of the header because the GOOGLE_DCHECK produces a lot of code.
InternalMetadata::~InternalMetadata() {
  if (HasMessageOwnedArenaTag()) {
    GOOGLE_DCHECK(!HasUnknownFieldsTag());
    delete reinterpret_cast&lt;Arena*&gt;(ptr_ - kMessageOwnedArenaTagMask);
  }
}
#endif
</code></pre><p>è¿™é‡Œçš„æœ¬æ„æ˜¯åœ¨éDebugæ¨¡å¼ä¸‹è¿™ä¸ªææ„å†™å¤´æ–‡ä»¶é‡Œï¼Œè¿™æ ·æŸäº›ç¼–è¯‘å™¨å’Œç¼–è¯‘é€‰é¡¹å¯ä»¥è¢«è‡ªåŠ¨å†…è¿ï¼Œå¯ä»¥ä¼˜åŒ–æ‰ã€‚è€Œè°ƒè¯•æ¨¡å¼ä¸‹æœ‰é¢å¤–çš„æ£€æŸ¥èµ°æœ¬åœ°çš„ç¬¦å·ã€‚
ä½†æ˜¯è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨ç¼–è¯‘ä¾èµ–åº“é‡‡ç”¨Releaseæ¨¡å¼ï¼Œè€Œä½¿ç”¨è€…å¯èƒ½å¤„äºDebugæ¨¡å¼ã€‚è¿™å°±æ„å‘³ç€ç¼–è¯‘ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> çš„æ—¶å€™æ˜¯å¯èƒ½è¢«ä¼˜åŒ–æ‰è€Œæ²¡æœ‰è¿™ä¸ªç¬¦å·çš„ã€‚
ä½†æ˜¯ä½¿ç”¨è€…è®¤ä¸ºæœ‰è¿™ä¸ªç¬¦å·ï¼Œæœ€ç»ˆé“¾æ¥å¤±è´¥ã€‚</p><p>è¿™ä¸ªé—®é¢˜åœ¨ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v21.4/v3.21.4 ç‰ˆæœ¬é‡Œè¿›è¡Œäº†éƒ¨åˆ†ä¿®å¤ï¼Œä½†æ˜¯æŸäº›ç¼–è¯‘ç¯å¢ƒè¿˜æ˜¯æœ‰é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v21/v3.21 ç‰ˆæœ¬é‡Œ <a href=https://github.com/protocolbuffers/protobuf/blob/v21.12/src/google/protobuf/metadata_lite.h#L81>metadata_lite.h#L81</a> çš„ä»£ç ã€‚</p><pre><code class=language-cpp>  ~InternalMetadata() {
#if defined(NDEBUG) || defined(_MSC_VER)
    if (HasMessageOwnedArenaTag()) {
      delete reinterpret_cast&lt;Arena*&gt;(ptr_ - kMessageOwnedArenaTagMask);
    }
#else
    CheckedDestruct();
#endif
  }
</code></pre><p>å’‹ä¸€çœ‹å¥½åƒæ˜¯æ²¡é—®é¢˜äº†ã€‚æ— è®ºä»€ä¹ˆæƒ…å†µéƒ½æœ‰ <code>~InternalMetadata()</code> äº†ï¼Œä½†æ˜¯C++ç¼–è¯‘å™¨åœ¨è‡ªåŠ¨å†…è”ä¸€è¯´ï¼ŒğŸ˜‚ã€‚æŸäº›ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ <code>.pb.cc</code> æ—¶å¦‚æœèµ°ä¸‹é¢çš„åˆ†æ”¯è‡ªåŠ¨å†…è”äº†ï¼Œé‚£ä¹ˆå°±ä¸ä¼šç”Ÿæˆ <code>~InternalMetadata()</code> è¿™ä¸ªç¬¦å·ã€‚è¿™ä¸ªç±»çš„ææ„åœ¨ <code>MessageLite</code> è¿™ä¸ªç±»ä¸­è¢«è°ƒç”¨ï¼Œåœ¨ç”Ÿæˆçš„ <code>.pb.cc</code> é‡Œæ˜¯é…æœ‰è¢«ç›´æ¥è°ƒç”¨çš„ã€‚ä½†æ˜¯æŸäº›ç¼–è¯‘å™¨ä¼šç”Ÿæˆå¯¹å®ƒçš„ææ„ç¬¦å·çš„å¼•ç”¨ï¼ˆå¯èƒ½ä¹Ÿå±äºç¼–è¯‘å™¨çš„BUGï¼‰ã€‚
è¿™æ—¶å€™åˆä¼šå¯¼è‡´ç¬¦å·æœªå®šä¹‰ã€‚</p><blockquote><p>æˆ‘ä»¬å‘ç°é—®é¢˜çš„ç¯å¢ƒæ˜¯ç¼–è¯‘iOSç‰ˆæœ¬æ—¶ï¼Œå…·ä½“ç¼–è¯‘å™¨ç‰ˆæœ¬å·å¿˜è®°äº†ï¼Œå¥½åƒæ˜¯AppleClang 12æˆ–è€…AppleClang 13ã€‚</p></blockquote><p>è§£å†³è¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠå£°æ˜æ”¹æˆ <code>PROTOBUF_NOINLINE ~InternalMetadata()</code> å°±è¡Œäº†ã€‚
ä»¥ä¸Šé—®é¢˜ä¹Ÿå¯ä»¥åœ¨æˆ‘ä»¬çš„æ„å»ºç³»ç»Ÿé¡¹ç›®ä¸­æ‰¾åˆ°Patchæ–‡ä»¶ï¼ˆè¿˜åŒ…å«å°‘é‡å…¶ä»–é—®é¢˜çš„é€‚é…ï¼‰:</p><ul><li><a href=https://github.com/atframework/cmake-toolset/blob/main/ports/protobuf/protobuf-v3.21.1.patch>https://github.com/atframework/cmake-toolset/blob/main/ports/protobuf/protobuf-v3.21.1.patch</a></li><li><a href=https://github.com/atframework/cmake-toolset/blob/main/ports/protobuf/protobuf-v3.21.4.patch>https://github.com/atframework/cmake-toolset/blob/main/ports/protobuf/protobuf-v3.21.4.patch</a></li></ul><h3 id=xxx_default_instance_-æœªå®šä¹‰><code>XXX_default_instance_</code> æœªå®šä¹‰</h3><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯é»˜è®¤çš„instanceç¬¦å·æœªå®šä¹‰çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜å­˜åœ¨äº v21/v3.21 åˆ°ç›®å‰æœ€æ–°ç‰ˆæœ¬ ï¼ˆv23/4.23ï¼‰ã€‚æˆ‘æ²¡æœ‰è¿½æŸ¥æ›´æ—©ç‰ˆæœ¬ï¼Œå¤§æ¦‚ç‡ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚
æŠ¥çš„é”™è¯¯å¤§è‡´æ˜¯ <code>"struct XXX YYYY_default_instance_"</code> ç¬¦å·æœªå®šä¹‰ã€‚è§¦å‘æ¡ä»¶æ¯”è¾ƒå¤šï¼š</p><ul><li>éœ€è¦ç¼–è¯‘æˆåŠ¨æ€åº“</li><li>é»˜è®¤ç¬¦å·éšè—ï¼ˆWindowsé»˜è®¤éšè—ï¼ŒLinuxé»˜è®¤å¯è§ï¼‰</li><li>ä½¿ç”¨ <code>dllexport_decl=</code> æ¥è®¾ç½®å¯¼å‡ºç¬¦å·</li></ul><p>åœ¨Windowsä¸­ä¸ªï¼Œæ¯ä¸€ä¸ªdllå’Œexecéƒ½æœ‰è‡ªå·±çš„ç¬¦å·è¡¨å’Œå †ç®¡ç†ã€‚æ‰€ä»¥å½“ä½¿ç”¨dllæ—¶ï¼Œéœ€è¦æŠŠè¦å¯¼å‡ºçš„ç¬¦å·è®¾ç½®ä¸º <code>__declspec(dllexport)/__attribute__((__dllexport__))</code>, å¯¼å…¥çš„æ—¶å€™è®¾ç½®ä¸º <code>__declspec((dllimport))/__attribute__((__dllimport__))</code> ã€‚
è€Œåœ¨Linuxé‡Œï¼Œé»˜è®¤æ˜¯å…±äº«ä¸”å…¨å±€å¯è§çš„ã€‚è€Œå¾ˆå¤šæ„å»ºç³»ç»Ÿä¸­ä¼šæŠŠWindowsç‰ˆæœ¬ä¾èµ–ä½¿ç”¨é™æ€åº“ï¼Œæ‰€ä»¥å¾ˆå¤šåŒå­¦ä¸ä¼šç¢°åˆ°è¿™äº›é—®é¢˜ã€‚</p><p>æœ‰ä¸€äº›æ›´ä¸¥è°¨æ›´å®‰å…¨é˜²æ­¢ç¬¦å·å†²çªçš„æ–¹å¼æ˜¯å§Linuxä¸‹ç¬¦å·ä¹Ÿé€šè¿‡ <code>__attribute__((visibility("hidden")))</code> è®¾ä¸ºé»˜è®¤éšè—ï¼Œç„¶åå¯¹äºè¦å¯¼å‡ºçš„ç¬¦å·è®¾ç½®ä¸º <code>__attribute__((visibility("default")))</code> æ¥å…±äº«ï¼ˆæ¯”å¦‚Unreal Engineçš„æ„å»ºç³»ç»Ÿï¼‰ã€‚è¿™æ—¶å€™é€šå¸¸çš„åšæ³•æ˜¯æä¾›ä¸€ä¸ªå®ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™è®¾ç½®PRIVATEå®šä¹‰ä¸º <code>__declspec(__dllimport__)/__attribute__((__dllimport__))/__attribute__((visibility("default")))</code> å¯¹å¤–ä¼ é€’çš„PUBLICå®šä¹‰ä¸º <code>__declspec(dllexport)/__attribute__((__dllexport__))/__attribute__((visibility("default")))</code> ã€‚</p><p>åœ¨ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œç”±äº <code>.pb.cc</code> ä¸­å­˜åœ¨å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å…è®¸åŒä¸€ä¸ªå…¨å±€å˜é‡åœ¨å¤šä¸ªåŠ¨æ€åº“ä¸­ï¼Œå¦åˆ™ä¼šé‡å¤æ³¨å†Œå’Œæ‰§è¡Œæ„é€ ææ„å‡½æ•°ã€‚é‚£ä¹ˆä¸ºäº†å®ç°ä¸Šé¢çš„æµç¨‹ï¼Œ<a href=https://github.com/protocolbuffers/protobuf>protobuf</a> æä¾›äº†ä¸€ä¸ªç”Ÿæˆé€‰é¡¹ <code>dllexport_decl</code>ï¼Œç”¨æ¥å¯¹è¦å¯¼å‡ºçš„ç¬¦å·æŒ‡å®šè¿™ä¸ªå®ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªè¿™ä¸ªé—®é¢˜å¯¹åº”çš„ç”Ÿæˆä»£ç ï¼ˆé€‰é¡¹æ˜¯ <code>--cpp_out=dllexport_decl=TGF_BATTLE_PROTOCOL_API:&lt;OUT DIR></code>ï¼‰ã€‚
é¦–å…ˆå¯¹äº <code>.pb.h</code> :</p><pre><code class=language-cpp>class DBattleAffix;
struct DBattleAffixDefaultTypeInternal;
TGF_BATTLE_PROTOCOL_API extern DBattleAffixDefaultTypeInternal _DBattleAffix_default_instance_;

// ...
class TGF_BATTLE_PROTOCOL_API DBattleAffix final : // ...
{
  // ...
  static inline const DBattleAffix* internal_default_instance() {
    return reinterpret_cast&lt;const DBattleAffix*&gt;(
               &amp;_DBattleAffix_default_instance_);
  }
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ‰æ¥å£å¼•ç”¨äº† <code>_DBattleAffix_default_instance_</code> è¿™ä¸ªå…¨å±€å˜é‡çš„åœ°å€ã€‚é‚£ä¹ˆåœ¨ <code>.pb.cc</code> é‡Œ:</p><pre><code class=language-cpp>struct DBattleAffixDefaultTypeInternal {
  PROTOBUF_CONSTEXPR DBattleAffixDefaultTypeInternal()
      : _instance(::_pbi::ConstantInitialized{}) {}
  ~DBattleAffixDefaultTypeInternal() {}
  union {
    DBattleAffix _instance;Bu
  };
};
PROTOBUF_ATTRIBUTE_NO_DESTROY PROTOBUF_CONSTINIT PROTOBUF_ATTRIBUTE_INIT_PRIORITY1 DBattleAffixDefaultTypeInternal _DBattleAffix_default_instance_;
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>.pb.cc</code> é‡Œé¢å¹¶æ²¡æœ‰è®¾ç½® <code>TGF_BATTLE_PROTOCOL_API</code> æ¥å¯¼å‡ºç¬¦å·ï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´ç±»ä¼¼ä¸‹é¢è¿™æ ·çš„é“¾æ¥é”™è¯¯:</p><pre><code class=language-bash>7&gt;TGFBattleUtility.lib(BattleAffixAlgorithm.obj): Error LNK2001: unresolved external symbol &quot;struct tgf::DBattleAffixDefaultTypeInternal tgf::_DBattleAffix_default_instance_&quot; (?_DBattleAffix_default_instance_@tgf@@3UDBattleAffixDefaultTypeInternal@1@A)
</code></pre><p>é‚£ä¹ˆè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ <code>protoc</code> çš„ä»£ç é‡Œè¡¥ä¸Šè¿™äº›ï¼Œï¼ˆv21å’Œv23ç‰ˆæœ¬å˜åŒ–æ¯”è¾ƒå¤§ï¼Œå…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢çš„patch filesï¼‰</p><ul><li><a href=https://github.com/atframework/cmake-toolset/blob/main/ports/protobuf/protobuf-v3.21.12.patch>https://github.com/atframework/cmake-toolset/blob/main/ports/protobuf/protobuf-v3.21.12.patch</a></li><li><a href=https://github.com/atframework/cmake-toolset/blob/8c8659f2d64283b02a24b7c34ffcd0d24eb03ca6/ports/protobuf/protobuf-v23.patch>https://github.com/atframework/cmake-toolset/blob/8c8659f2d64283b02a24b7c34ffcd0d24eb03ca6/ports/protobuf/protobuf-v23.patch</a></li></ul><p>è¿™ä¸ªissueå·²ç»æäº¤åˆ° <a href=https://github.com/protocolbuffers/protobuf/issues/13084>https://github.com/protocolbuffers/protobuf/issues/13084</a> å¹¶ä¸”BUGä¿®å¤çš„PRåœ¨ <a href=https://github.com/protocolbuffers/protobuf/pull/13085>https://github.com/protocolbuffers/protobuf/pull/13085</a> ã€‚æœ‰å…´è¶£çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥è·Ÿè¿›ã€‚</p><h2 id=grpc-çš„é“¾æ¥å’Œç¼–è¯‘é—®é¢˜><a href=https://github.com/grpc/grpc>gRPC</a> çš„é“¾æ¥å’Œç¼–è¯‘é—®é¢˜</h2><h3 id=grpc-çš„-v1540-çš„é“¾æ¥ç¬¦å·é—®é¢˜><a href=https://github.com/grpc/grpc>gRPC</a> çš„ v1.54.0 çš„é“¾æ¥ç¬¦å·é—®é¢˜</h3><p>æˆ‘ä»¬åœ¨ä½¿ç”¨é«˜ç‰ˆæœ¬ç¼–è¯‘å™¨æ—¶ï¼Œä¼šå°½å¯èƒ½ä½¿ç”¨é«˜ç‰ˆæœ¬çš„STDæ ‡å‡†ã€‚åœ¨C++17ä»¥å <code>constexpr</code> å…³é”®å­—éšå¼ä¼šè¢«é™„åŠ  <code>inline</code> ï¼ˆè¯¦æƒ…å‚è€ƒ: <a href=https://en.cppreference.com/w/cpp/language/constexpr>https://en.cppreference.com/w/cpp/language/constexpr</a>ï¼‰ã€‚
è¿™æ„å‘³ç€è¿™äº›å˜é‡å¯èƒ½ä¸ä¼šç”Ÿæˆå®é™…çš„ç¬¦å·ã€‚é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ã€‚æˆ‘ä»¬æ¥çœ‹v1.54.0 ç‰ˆæœ¬çš„ä»£ç :</p><p>é¦–å…ˆ <code>src/core/ext/gcp/metadata_query.h</code> :</p><pre><code class=language-cpp>class MetadataQuery : public InternallyRefCounted&lt;MetadataQuery&gt; {
 public:
  static const char kZoneAttribute[];
  static const char kClusterNameAttribute[];
  static const char kRegionAttribute[];
  static const char kInstanceIdAttribute[];
  static const char kIPv6Attribute[];
// ...
</code></pre><p>ç„¶å <code>src/core/ext/gcp/metadata_query.cc</code> :</p><pre><code class=language-cpp>constexpr const char MetadataQuery::kZoneAttribute[] =
    &quot;/computeMetadata/v1/instance/zone&quot;;
constexpr const char MetadataQuery::kClusterNameAttribute[] =
    &quot;/computeMetadata/v1/instance/attributes/cluster-name&quot;;
constexpr const char MetadataQuery::kRegionAttribute[] =
    &quot;/computeMetadata/v1/instance/region&quot;;
constexpr const char MetadataQuery::kInstanceIdAttribute[] =
    &quot;/computeMetadata/v1/instance/id&quot;;
constexpr const char MetadataQuery::kIPv6Attribute[] =
    &quot;/computeMetadata/v1/instance/network-interfaces/0/ipv6s&quot;;
</code></pre><p>è¿™æ—¶å€™ï¼ŒæŸäº›ç¼–è¯‘ç¯å¢ƒä¸‹è¿™äº›å˜é‡è¢«inlineäº†ä»¥åï¼Œå°±ä¼šå‡ºç°æœªå®šä¹‰ç¬¦å·çš„é—®é¢˜ã€‚
ç›¸å…³ä¿®å¤æ”¾åœ¨äº† <a href=https://github.com/atframework/cmake-toolset/blob/main/ports/grpc/grpc-v1.54.0.patch>https://github.com/atframework/cmake-toolset/blob/main/ports/grpc/grpc-v1.54.0.patch</a> ã€‚
åŒæ—¶è¿™ä¸ªBUGåœ¨ v1.54.2 é‡Œå·²ç»è¢«ä¿®å¤ã€‚</p><h3 id=grpc-çš„åœ¨éƒ¨åˆ†ç¼–è¯‘å™¨ä¸Šçš„å…¼å®¹æ€§é—®é¢˜><a href=https://github.com/grpc/grpc>gRPC</a> çš„åœ¨éƒ¨åˆ†ç¼–è¯‘å™¨ä¸Šçš„å…¼å®¹æ€§é—®é¢˜</h3><p>æŒ‰ç…§ <a href=https://en.cppreference.com/w/cpp/memory/unique_ptr>https://en.cppreference.com/w/cpp/memory/unique_ptr</a> çš„è¦æ±‚ï¼Œ <code>std::unqieur_ptr&lt;T, std::default_delete&lt;T>></code> ä¸­çš„ <code>T</code> åº”è¯¥æ˜¯å…è®¸å‰ç½®å£°æ˜çš„ã€‚
ä½†æ˜¯æŸäº›ç¼–è¯‘å™¨æˆ–è€…STLå®ç°çš„é—®é¢˜ï¼Œå¯¼è‡´å¼€å¯æœ€é«˜æ”¯æŒæ ‡å‡†æ—¶ <code>src/core/lib/surface/server.h</code> é‡Œå‰ç½®ç”³æ˜ç±»å‹ç”¨åœ¨ <code>std::unqieur_ptr</code> æ—¶ä¼šæŠ¥ <code>incomplete type</code> çš„é—®é¢˜ã€‚
ä¸´æ—¶çš„å¤„ç†æ–¹å¼æ˜¯æŠŠå®ƒä»¬æ”¹æˆ <code>shared_ptr</code> ï¼Œè™½ç„¶æš‚æ—¶æœ‰è½»å¾®çš„æ€§èƒ½æŸå¤±ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥åç»­ç­‰å®˜æ–¹æ›´å®Œæ•´çš„ä¿®å¤ã€‚Patchæ–‡ä»¶åœ¨ <a href=https://github.com/atframework/cmake-toolset/blob/main/ports/grpc/grpc-v1.54.2.patch>https://github.com/atframework/cmake-toolset/blob/main/ports/grpc/grpc-v1.54.2.patch</a></p><h2 id=æœ€å>æœ€å</h2><p>è¿‘æœŸç¢°åˆ°çš„ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> å’Œ <a href=https://github.com/grpc/grpc>gRPC</a> çš„æ„å»ºå‘ä¹Ÿå°±è¿™ä¹ˆå¤šã€‚åç»­é’ˆå¯¹ <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v22+ å’Œ <a href=https://github.com/grpc/grpc>gRPC</a> v1.55+ è¿˜æœ‰ä¸€äº›æ¯”è¾ƒé‡å¤§çš„å˜åŒ–ã€‚å¯¼è‡´æˆ‘ä»¬çš„Patchè¿‡ç¨‹æœ‰ä¸€ä¸ªå¤§æ”¹é€ ã€‚ç‰¹åˆ«æ˜¯è®¾è®¡upbçš„éƒ¨åˆ†ã€‚
è¿™éƒ¨åˆ†åç»­åœ¨å†™åˆ†äº«å§ï¼Œä¹Ÿæ¬¢è¿æœ‰å…´è¶£çš„å°ä¼™ä¼´äº¤æµã€‚</p></div><hr><footer class=article-footer><div class="article-panel-footer article-meta article-footer clearfix"><span class=article-meta-left><ol><li><a href=//owent.net/categories/article.html>Article</a></li><li><a href=//owent.net/categories/blablabla.html>Blablabla</a></li></ol></span><span class=article-meta-right><time datetime=2023-06-16T22:25:45.000+00:00 itemprop=datePublished>2023-06-16</time></span>
<span class=clearfix></span></div><div class=article-tags><ul class=article-tag-list><li class=article-tag-list-item><a href=//owent.net/tags/protobuf.html>protobuf</a></li><li class=article-tag-list-item><a href=//owent.net/tags/internalmetadata.html>InternalMetadata</a></li><li class=article-tag-list-item><a href=//owent.net/tags/%E6%9C%AA%E5%AE%9A%E4%B9%89%E7%AC%A6%E5%8F%B7.html>æœªå®šä¹‰ç¬¦å·</a></li><li class=article-tag-list-item><a href=//owent.net/tags/cmake-toolset.html>cmake-toolset</a></li></ul></div></footer><div class="ads-placeholder ads-container"><ins class="adsbygoogle ads_infeed" style=display:block data-ad-client=ca-pub-8180054975285991 data-ad-slot=5599802929 data-ad-format="rectangle, horizontal" data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><hr><nav id=article-nav><ul class=pagination><li class=page-item><a class=page-link id=article-nav-newer class=article-nav-link-wrap href=//owent.net/2023/2306.html>ä¸Šä¸€ç¯‡<strong>protobuf v22å’ŒgRPC v1.55ç‰ˆæœ¬å‡çº§çš„ä¾èµ–å˜åŒ–å’Œupbé€‚é…</strong></a></li><li class=page-item><a class=page-link id=article-nav-older class=article-nav-link-wrap href=//owent.net/2023/2304.html>ä¸‹ä¸€ç¯‡<strong>xresloader-Excelå¯¼è¡¨å·¥å…·é“¾çš„è¿‘æœŸå˜æ›´æ±‡æ€»</strong></a></li></ul></nav><hr><script src=https://utteranc.es/client.js repo=owent/blog-website issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></article></div></section></div><footer id=footer><div class=outer><div id=footer-info class="inner clearfix"><strong id=footer-left class="float-left float-start"><a rel=license href=https://github.com/owent/blog-hugo/blob/master/LICENSE.md><img alt=çŸ¥è¯†å…±äº«è®¸å¯åè®® style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>2025&nbsp;owent
</strong><strong id=footer-right class="float-right float-end"><a href=https://beian.miit.gov.cn/ target=_blank>æ²ªICPå¤‡2022003252å·</a>&nbsp;&nbsp;<a href=https://github.com/owent/blog-hugo target=_blank>æœ¬ç«™æºç </a>,
å‘å¸ƒè€… <a href=https://gohugo.io/ target=_blank>Hugo</a>,
ä¸»é¢˜ <a href=https://github.com/owent/hugo-theme-distinctionpp target=_blank>distinctionpp</a>
</strong><span class=clearfix></span></div></div></footer></div><script type=module>// import * as Popper from "@popperjs/core";// import * as bootstrap from "bootstrap";
// import React from "react";

        
</script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/highlight.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/awk.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/bash.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cpp.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/capnproto.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cmake.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/d.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/diff.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dockerfile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dos.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/erlang.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/go.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/less.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/llvm.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/lua.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/php.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/powershell.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/protobuf.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/python.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/profile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/typescript.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/vim.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/rust.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/yaml.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/@highlightjs/cdn-assets@latest/styles/vs2015.min.css",document.querySelector("head").appendChild(t),window.JSON?hljs.configure(JSON.parse('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}')):hljs.configure(evel('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}'));const n={};for(const e of hljs.listLanguages())n[e.toLowerCase()]=!0;for(const e of document.querySelectorAll("pre>code"))try{if(e.className.match(/\bmermaid\b/i)){e.classList.add("mermaid");continue}if(e.className.match(/\bnohighlight\b/i))continue;const t=e.className.match(/language-([^\s]+)/i);if(t&&t.length>=2&&hljs.getLanguage(t[1]))hljs.highlightElement(e);else{const t=hljs.highlightAuto(e.innerText,hljs.listLanguages());t&&t.value&&(e.innerHTML=t.value,e.classList.add("hljs"))}}catch(e){window.console&&console.log(e.toString()+`\r
Maybe can not detect the language`)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PQEY77BYG1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PQEY77BYG1")}</script><script type=text/javascript src=//unpkg.com/katex@latest/dist/katex.min.js></script><script type=text/javascript src=//unpkg.com/katex@latest/dist/contrib/auto-render.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/katex@latest/dist/katex.min.css",document.querySelector("head").appendChild(t),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1,ignoredTags:["script","noscript","style","textarea","pre","code"]})})</script><script type=text/javascript src=//unpkg.com/chart.js@latest/dist/chart.umd.js></script><script type=module>
import mermaid from "mermaid";
const config = {
    theme: 'neutral',
    logLevel: 'fatal',
    securityLevel: 'loose', 
    startOnLoad: true,
    arrowMarkerAbsolute: false,
    

};
mermaid.initialize(config);
</script><script type=text/javascript>var _hmt=_hmt||[];(function(){var t,n,e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6a0daf8d58889f1cf55a353867bfdbb0",t=document.getElementsByTagName("script"),n=document.getElementsByTagName("script")[t.length-1],n.parentNode.appendChild(e)})()</script></div></body></html>