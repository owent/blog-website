<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>protobuf v22和gRPC v1.55版本升级的依赖变化和upb适配|I'm OWenT</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=canonical href=//owent.net/2023/2306.html><link rel=icon href=/favicon.ico><link rel=stylesheet href=//unpkg.com/bootstrap@latest/dist/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=//owent.net//css/style.css><link rel=stylesheet href=//owent.net/css/syntax.css><script type=importmap>
{
  "imports": {
    "react": "//unpkg.com/react@latest",
    "react-bootstrap": "//unpkg.com/react-bootstrap@latest",
    "mermaid": "//unpkg.com/mermaid@latest/dist/mermaid.esm.min.mjs",
    "bootstrap": "//unpkg.com/bootstrap@latest/dist/js/bootstrap.esm.min.js",
    "@popperjs/core": "//unpkg.com/@popperjs/core@latest/dist/esm/popper.js"
  }
}
</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8180054975285991" crossorigin=anonymous></script><meta content="codeva-4M5iohb9TW" name=baidu-site-verification></head><body><div id=container><div id=wrap><header id=header><div id=banner></div><div id=header-outer><div id=header-title><h1 id=site-title><a href=//owent.net/ id=logo>I'm OWenT</a></h1><h2 id=site-description>Challenge Everything</h2></div><div id=header-inner><nav id=main-nav class="navbar navbar-expand-md navbar-dark"><button class="navbar-toggler navbar-toggler-right" type=button data-bs-toggle=collapse data-bs-target=#main-nav-links aria-controls=main-nav-links aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<a id=main-nav-brand class="navbar-brand collapse" href=#>#</a><div class="collapse navbar-collapse position-relative" id=main-nav-links><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/index.html title=Home>Home</a></li><li class=nav-item><a class=nav-link href=/archives/index.html title=Archives>Archives</a></li><li class=nav-item><a class=nav-link href=/about/index.html title=About>About</a></li></ul><div class="col-12 col-xl-2 col-lg-3 col-md-4" id=main-nav-search><form class=input-group method=get accept-charset=UTF-8 action=//www.bing.com/search><input type=hidden name=q1 value=site:owent.net>
<input class=form-control type=text placeholder=搜索 name=q>
<button class="btn btn-outline-secondary my-0" type=submit>搜索</button></form></div></div></nav></div></div></header><div id=main><section id=main-content><div id=post-content><article id=post-73da787ee9643f7665c4b2b7aa02d05e class="article-panel article article-type-post" itemscope itemprop=blogPost><div class="article-panel-inner article-inner"><div class=article-inner><header class=article-header><h1 itemprop=name><a class=article-title href=//owent.net/2023/2306.html target=_blank itemprop=url>protobuf v22和gRPC v1.55版本升级的依赖变化和upb适配</a></h1></header><hr><div id=toc class="well toc m-3 p-1 pr-1 pt-1 pb-2 float-md-right float-md-end"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#protobuf-引入了新依赖><a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 引入了新依赖</a></li><li><a href=#grpc-v155-和-upb><a href=https://github.com/grpc/grpc>gRPC</a> v1.55 和 <a href=https://github.com/protocolbuffers/upb>upb</a></a></li><li><a href=#写在最后>写在最后</a></li></ul></nav><div class="ads-placeholder ads-container"><ins class="adsbygoogle ads_toc" style=display:block data-ad-client=ca-pub-8180054975285991 data-ad-slot=1249494377 data-ad-format="rectangle, vertical" data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><br><div class=article-entry itemprop=articleBody><h2 id=前言>前言</h2><p>近期的 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v22和 <a href=https://github.com/grpc/grpc>gRPC</a> v1.55 版本在构建流程层面引入了一些比较大的变化。
最初我关注到这个问题是在我参与的一个社区项目 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 的issue中（ <a href=https://github.com/open-telemetry/opentelemetry-cpp/issues/2095>https://github.com/open-telemetry/opentelemetry-cpp/issues/2095</a> ）。
直到后来，我们在自己的构建系统 <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> 对 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 和 <a href=https://github.com/grpc/grpc>gRPC</a> 也进行了升级。所以顺带给社区的项目也提交了一些相关的Patch，在这里分享一下可能其他同学也会碰到。</p><h2 id=protobuf-引入了新依赖><a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 引入了新依赖</h2><p><a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 从v22开始引入了对 <a href=https://github.com/abseil/abseil-cpp.git>abseil-cpp</a> 的依赖。和 <a href=https://github.com/grpc/grpc>gRPC</a> 类似，它也可以通过 <code>"-Dprotobuf_ABSL_PROVIDER=package"</code> 告知构建系统从已安装位置查找，而不是自己重新构建一套。
另外对构建流程的影响就是，我在 <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> 中把 <a href=https://github.com/abseil/abseil-cpp.git>abseil-cpp</a> 单独抽离出来并放在了 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 之前了。
同时在我们的UE工程里依赖protobuf的位置也要链接 <a href=https://github.com/abseil/abseil-cpp.git>abseil-cpp</a> 的相关依赖库，比如 <code>absl_strings</code>, <code>absl_bad_variant_access</code> 等等。</p><p>同时，它还移除了一些和 <a href=https://github.com/abseil/abseil-cpp.git>abseil-cpp</a> 内重复的接口，比如说原来做Base64转换的接口被移除了，现在适配 <code>Base64Escape</code> 的代码更长了, 比如下面对 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 的PR <a href=https://github.com/open-telemetry/opentelemetry-cpp/pull/2163/files#diff-eb7f99ebc152d9cc0f4781cc0a0388907e4d4b58271dba85eba99fd16b880674>#2163</a>。</p><pre><code class=language-cpp>#if defined(HAVE_ABSEIL)
#  include &quot;absl/strings/escaping.h&quot;
#elif defined(GOOGLE_PROTOBUF_VERSION) &amp;&amp; GOOGLE_PROTOBUF_VERSION &gt;= 3007000
#  include &quot;google/protobuf/stubs/strutil.h&quot;
#else
#  include &quot;google/protobuf/stubs/port.h&quot;
#  include &quot;google/protobuf/stubs/stringpiece.h&quot;
namespace google
{
namespace protobuf
{
LIBPROTOBUF_EXPORT void Base64Escape(StringPiece src, std::string *dest);
}  // namespace protobuf
}  // namespace google
#endif

// ...
      std::string base64_value;
#if defined(HAVE_ABSEIL)
      absl::Base64Escape(bytes, &amp;base64_value);
#else
      google::protobuf::Base64Escape(bytes, &amp;base64_value);
#endif
</code></pre><h2 id=grpc-v155-和-upb><a href=https://github.com/grpc/grpc>gRPC</a> v1.55 和 <a href=https://github.com/protocolbuffers/upb>upb</a></h2><p>去年我们项目组尝试使用 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 官方的 <a href=https://github.com/protocolbuffers/upb>upb</a> 来实现lua集成，并写了一篇相关的分享： <a href=https://owent.net/2022/2207.html>《集成 upb 和 lua binding 的踩坑小记》</a> 。
当时的主要问题是 <a href=https://github.com/grpc/grpc>gRPC</a> 中集成了一个精简版的 <a href=https://github.com/protocolbuffers/upb>upb</a>，只包含运行时，不包含protoc-upb，protoc-upbdefs和protoc-upblua插件。
当我们要使用完整版本时，就需要自己编译出这几个组件，并且和 <a href=https://github.com/grpc/grpc>gRPC</a> 混用的时候还需要版本保持一致，以防出现ABI兼容性问题。</p><p><a href=https://github.com/protocolbuffers/upb>upb</a> 主要使用的是 <a href=https://bazel.build/>bazel</a> 构建系统，而我们使用 <a href=https://cmake.org/>cmake</a>， <a href=https://github.com/grpc/grpc>gRPC</a> 也支持 <a href=https://cmake.org/>cmake</a>。由于 <a href=https://github.com/protocolbuffers/upb>upb</a> 的外部依赖只有一项，且使用的功能比较简单。所以在 <a href=https://github.com/protocolbuffers/upb>upb</a> 的仓库里有一个简单的工具，去hook了 <a href=https://bazel.build/>bazel</a> 的基础接口，输出 <a href=https://cmake.org/>cmake</a> 的工程文件。
由于这个输出的 <a href=https://cmake.org/>cmake</a> 的工程文件只包含了运行时，不包含上面提到的几个插件的编译，所以我们就需要是修改这个工具，让它也能输出插件和常见的 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 的well known type的upb支持文件。</p><p>在之前版本中，几乎是手夯了这几个工具及依赖构建流程。然后由于依赖中有直接源码引入第三方库 <a href=https://github.com/protocolbuffers/utf8_range>utf8_range</a>，并且文件的位置相当随意。所以当时也是重新调整了一些依赖文件的位置，以减少未来冲突的可能性。另外由于原有导出的 <a href=https://cmake.org/>cmake</a> 工程文件不支持导出现代化 <a href=https://cmake.org/>cmake</a> 的CONFIG的package文件，所以也需要我们自己做支持来实现更好的依赖关系管理。
这些修订都可以在 <a href=https://github.com/atframework/cmake-toolset/blob/8c8659f2d64283b02a24b7c34ffcd0d24eb03ca6/ports/grpc/upb-e4635f223e7d36dfbea3b722a4ca4807a7e882e2.patch>https://github.com/atframework/cmake-toolset/blob/8c8659f2d64283b02a24b7c34ffcd0d24eb03ca6/ports/grpc/upb-e4635f223e7d36dfbea3b722a4ca4807a7e882e2.patch</a> 。这里面除了上述功能外还有一些对于高版本 lua 适配和某些接口使用是UB的修订。（这些修订已经推送上游，详见：<a href=https://github.com/protocolbuffers/upb/pull/735>https://github.com/protocolbuffers/upb/pull/735</a> 和 <a href=https://github.com/protocolbuffers/upb/issues/734>https://github.com/protocolbuffers/upb/issues/734</a> 。）</p><p>在新版本的 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 和 <a href=https://github.com/grpc/grpc>gRPC</a> 中，<a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 在开启单元测试时也依赖 <a href=https://github.com/protocolbuffers/utf8_range>utf8_range</a> 了，但是我们出预编译包可以不开启单元测试。而新版本 <a href=https://github.com/grpc/grpc>gRPC</a> 也更新了新版的 <a href=https://github.com/protocolbuffers/upb>upb</a>，这个变化就比较大了。</p><p>首先是bootstrap编译的过程增加了多个stage。stage0用预制的 <code>descriptor.upb.h</code> 和 <code>descriptor.upb.cc</code> 等等编译 protoc-upb 插件；然后用这个插件生成stage1阶段的 <code>descriptor.upb.h</code> 和 <code>descriptor.upb.cc</code> 编译 protoc-upb 插件；最后用stage1阶段生成的 protoc-upb 插件生成 <code>descriptor.upb.h</code> 和 <code>descriptor.upb.cc</code> 等去生成stage2阶段的protoc-upb 插件、protoc-upbdefs 插件和protoc-upblua 插件等等。最后发布的是stage2阶段的库和工具。同时每个stage都有一系列的依赖组件，需要去设置依赖链。</p><p>同时 <a href=https://github.com/protocolbuffers/upb>upb</a> 也升级了对 <a href=https://github.com/protocolbuffers/utf8_range>utf8_range</a> 的版本引用。新版本 <a href=https://github.com/protocolbuffers/utf8_range>utf8_range</a> 已经支持 <a href=https://cmake.org/>cmake</a> 的CONFIG的package包管理了。</p><p>为了我们整体可以用统一并且兼容性更好的管理方式，并且上面bootstrap编译过程全部手夯以后太难维护了，所以我干脆实现了原先 <a href=https://github.com/protocolbuffers/upb>upb</a> 里留空的 <code>def cc_binary(self, **kwargs):</code> , <code>def bootstrap_upb_proto_library(self, **kwargs):</code> , <code>def bootstrap_cc_library(self, **kwargs):</code> 和 <code>def bootstrap_cc_binary(self, **kwargs):</code> 。其中 <code>def bootstrap_upb_proto_library(self, **kwargs):</code> 比较复杂一些，三个stage不一样。</p><p>另外新版本的 <a href=https://github.com/protocolbuffers/upb>upb</a> 也依赖 <a href=https://github.com/abseil/abseil-cpp.git>abseil-cpp</a> 了，但是 <a href=https://github.com/abseil/abseil-cpp.git>abseil-cpp</a> 的 <a href=https://bazel.build/>bazel</a> 的target名称和 <a href=https://cmake.org/>cmake</a> 不完全一样，所以针对这些名字我们仍然需要手动转换。同理对 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 的libprotoc 相关的依赖也一样。</p><p>对这些变化的初版可用版本我放在了 <a href=https://github.com/atframework/cmake-toolset/blob/8c8659f2d64283b02a24b7c34ffcd0d24eb03ca6/ports/grpc/upb-61a97efa24a5ce01fb8cc73c9d1e6e7060f8ea98.patch>https://github.com/atframework/cmake-toolset/blob/8c8659f2d64283b02a24b7c34ffcd0d24eb03ca6/ports/grpc/upb-61a97efa24a5ce01fb8cc73c9d1e6e7060f8ea98.patch</a> ，这个版本对应 <a href=https://github.com/grpc/grpc>gRPC</a> v1.55 里引用的版本。然而 <a href=https://github.com/protocolbuffers/upb>upb</a> 的主干分支这个构建系统的流程又有一些变化和优化，为了方便以后维护，我就推了一个PR到 <a href=https://github.com/protocolbuffers/upb>upb</a> 主仓库，详见: <a href=https://github.com/protocolbuffers/upb/pull/1352/>https://github.com/protocolbuffers/upb/pull/1352/</a> 和两个相关的功能的issue: <a href=https://github.com/protocolbuffers/upb/issues/1350>https://github.com/protocolbuffers/upb/issues/1350</a> 和 <a href=https://github.com/protocolbuffers/upb/issues/1351>https://github.com/protocolbuffers/upb/issues/1351</a> 。不过按之前推的PR的响应速度，感觉这个仓库对PR的响应非常慢。</p><h2 id=写在最后>写在最后</h2><p>以上这些适配其实都是为了给 <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> 下一次升级做准备，但是现在还有一个上游库的支持没完成 （<a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 对protobuf v22+的支持，详见: <a href=https://github.com/open-telemetry/opentelemetry-cpp/pull/2163>https://github.com/open-telemetry/opentelemetry-cpp/pull/2163</a> ），所以现在是新拉了一个分支，尚未合入。这个仓库因为这个提交可能影响ABI兼容性，所以社区还需要继续评估。等最终这个上游仓库合入完成了，我们就可以给 <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> 也切到新版本了。</p><p>最后，欢迎对相关话题有兴趣的小伙伴们互相交流。</p></div><hr><footer class=article-footer><div class="article-panel-footer article-meta article-footer clearfix"><span class=article-meta-left><ol><li><a href=//owent.net/categories/article.html>Article</a></li><li><a href=//owent.net/categories/blablabla.html>Blablabla</a></li></ol></span><span class=article-meta-right><time datetime=2023-06-17T17:01:45.000+00:00 itemprop=datePublished>2023-06-17</time></span>
<span class=clearfix></span></div><div class=article-tags><ul class=article-tag-list><li class=article-tag-list-item><a href=//owent.net/tags/protobuf.html>protobuf</a></li><li class=article-tag-list-item><a href=//owent.net/tags/upb.html>upb</a></li><li class=article-tag-list-item><a href=//owent.net/tags/abseil.html>abseil</a></li><li class=article-tag-list-item><a href=//owent.net/tags/cmake-toolset.html>cmake-toolset</a></li><li class=article-tag-list-item><a href=//owent.net/tags/grpc.html>grpc</a></li></ul></div></footer><div class="ads-placeholder ads-container"><ins class="adsbygoogle ads_infeed" style=display:block data-ad-client=ca-pub-8180054975285991 data-ad-slot=5599802929 data-ad-format="rectangle, horizontal" data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><hr><nav id=article-nav><ul class=pagination><li class=page-item><a class=page-link id=article-nav-newer class=article-nav-link-wrap href=//owent.net/2023/2307.html>上一篇<strong>Excel转表工具(xresloader)的新验证器（验证外部Excel和文本数据，唯一性和自定义规则）</strong></a></li><li class=page-item><a class=page-link id=article-nav-older class=article-nav-link-wrap href=//owent.net/2023/2305.html>下一篇<strong>关于protobuf近期版本（v20/v3.20+）和 gRPC v1.54版本在某些编译环境下的一些链接和编译问题</strong></a></li></ul></nav><hr><script src=https://utteranc.es/client.js repo=owent/blog-website issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></article></div></section></div><footer id=footer><div class=outer><div id=footer-info class="inner clearfix"><strong id=footer-left class="float-left float-start"><a rel=license href=https://github.com/owent/blog-hugo/blob/master/LICENSE.md><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>2025&nbsp;owent
</strong><strong id=footer-right class="float-right float-end"><a href=https://beian.miit.gov.cn/ target=_blank>沪ICP备2022003252号</a>&nbsp;&nbsp;<a href=https://github.com/owent/blog-hugo target=_blank>本站源码</a>,
发布者 <a href=https://gohugo.io/ target=_blank>Hugo</a>,
主题 <a href=https://github.com/owent/hugo-theme-distinctionpp target=_blank>distinctionpp</a>
</strong><span class=clearfix></span></div></div></footer></div><script type=module>// import * as Popper from "@popperjs/core";// import * as bootstrap from "bootstrap";
// import React from "react";

        
</script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/highlight.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/accesslog.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/armasm.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/awk.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/basic.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/bnf.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/capnproto.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cmake.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/d.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dockerfile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dos.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/erlang.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/ebnf.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/latex.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/llvm.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/lua.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/powershell.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/protobuf.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/profile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/vim.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/x86asm.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/yaml.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/@highlightjs/cdn-assets@latest/styles/vs2015.min.css",document.querySelector("head").appendChild(t),window.JSON?hljs.configure(JSON.parse('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}')):hljs.configure(evel('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}'));const n={};for(const e of hljs.listLanguages())n[e.toLowerCase()]=!0;for(const e of document.querySelectorAll("pre>code"))try{if(e.className.match(/\bmermaid\b/i)){e.classList.add("mermaid");continue}if(e.className.match(/\bnohighlight\b/i))continue;const t=e.className.match(/language-([^\s]+)/i);if(t&&t.length>=2&&hljs.getLanguage(t[1]))hljs.highlightElement(e);else{const t=hljs.highlightAuto(e.innerText,hljs.listLanguages());t&&t.value&&(e.innerHTML=t.value,e.classList.add("hljs"))}}catch(e){window.console&&console.log(e.toString()+`\r
Maybe can not detect the language`)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PQEY77BYG1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PQEY77BYG1")}</script><script type=text/javascript src=//unpkg.com/katex@latest/dist/katex.min.js></script><script type=text/javascript src=//unpkg.com/katex@latest/dist/contrib/auto-render.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/katex@latest/dist/katex.min.css",document.querySelector("head").appendChild(t),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1,ignoredTags:["script","noscript","style","textarea","pre","code"]})})</script><script type=text/javascript src=//unpkg.com/chart.js@latest/dist/chart.umd.js></script><script type=module>
import mermaid from "mermaid";
const config = {
    theme: 'neutral',
    logLevel: 'fatal',
    securityLevel: 'loose', 
    startOnLoad: true,
    arrowMarkerAbsolute: false,
    

};
mermaid.initialize(config);
</script><script type=text/javascript>var _hmt=_hmt||[];(function(){var t,n,e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6a0daf8d58889f1cf55a353867bfdbb0",t=document.getElementsByTagName("script"),n=document.getElementsByTagName("script")[t.length-1],n.parentNode.appendChild(e)})()</script></div></body></html>