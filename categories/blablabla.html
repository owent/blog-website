<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Blablabla|I'm OWenT</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=canonical href=//owent.net/categories/blablabla.html><link rel=alternate type=application/rss+xml href=//owent.net/categories/blablabla/index.xml title="I'm OWenT"><link rel=icon href=/favicon.ico><link rel=stylesheet href=//unpkg.com/bootstrap@latest/dist/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=//owent.net//css/style.css><link rel=stylesheet href=//owent.net/css/syntax.css><script type=importmap>
{
  "imports": {
    "react": "//unpkg.com/react@latest",
    "react-bootstrap": "//unpkg.com/react-bootstrap@latest",
    "mermaid": "//unpkg.com/mermaid@latest/dist/mermaid.esm.min.mjs",
    "bootstrap": "//unpkg.com/bootstrap@latest/dist/js/bootstrap.esm.min.js",
    "@popperjs/core": "//unpkg.com/@popperjs/core@latest/dist/esm/popper.js"
  }
}
</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8180054975285991" crossorigin=anonymous></script><meta content="codeva-4M5iohb9TW" name=baidu-site-verification></head><body><div id=container><div id=wrap><header id=header><div id=banner></div><div id=header-outer><div id=header-title><h1 id=site-title><a href=//owent.net/ id=logo>I'm OWenT</a></h1><h2 id=site-description>Challenge Everything</h2></div><div id=header-inner><nav id=main-nav class="navbar navbar-expand-md navbar-dark"><button class="navbar-toggler navbar-toggler-right" type=button data-bs-toggle=collapse data-bs-target=#main-nav-links aria-controls=main-nav-links aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<a id=main-nav-brand class="navbar-brand collapse" href=#>#</a><div class="collapse navbar-collapse position-relative" id=main-nav-links><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/ title=Home>Home</a></li><li class=nav-item><a class=nav-link href=/archives.html title=Archives>Archives</a></li><li class=nav-item><a class=nav-link href=/about.html title=About>About</a></li><li class=nav-item><a id=nav-rss-link class=nav-link href=//owent.net/categories/blablabla/index.xml title=RSS订阅>RSS订阅</a></li></ul><div class="col-12 col-xl-2 col-lg-3 col-md-4" id=main-nav-search><form class=input-group method=get accept-charset=UTF-8 action=//www.bing.com/search><input type=hidden name=q1 value=site:owent.net>
<input class=form-control type=text placeholder=搜索 name=q>
<button class="btn btn-outline-secondary my-0" type=submit>搜索</button></form></div></div></nav></div></div></header><div id=main><section id=main-content><div id=archive-content><article class="article-panel archive-article archive-type-2503"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2025/2503.html target=_blank itemprop=url>指标上报的多线程优化和多拉取源点优化</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>我给我们的服务器框架深度集成了一些可观测性的能力。使用 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 作为接入层。
在指标方面，我们允许业务层自由地定制化指标上报和拉取，并以此实现策略控制。上报的时候有Pull模式接口（异步接口），也有Push模式接口（同步接口）。
为了减少 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 内部的视图合并开销，性能最佳，我们尽量使用异步接口。
但是这种情况下由于 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 内部存在后台Processor线程、Exporter线程等，指标的采集往往需要跨线程操作。
这就要求我们上报代码逻辑需要保证线程安全。</p></div><div class=article-more><a href=//owent.net/2025/2503.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2025-05-21T00:39:45.000+00:00 itemprop=datePublished>2025-05-21</time></div></div></article><article class="article-panel archive-article archive-type-2502"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2025/2502.html target=_blank itemprop=url>协程(libcopp)的Channel功能和CPU命中率优化</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>设计 <a href=https://owent.net/2022/2206.html>《libcopp对C++20协程的接入和接口设计》</a> 的时候，由于C++20协程的promise和awaitable是链式关联的。所以当时设计promise和awaitable之间通过一个共享的context来通信交互。当时第一版实现直接使用了 <code>std::shared_ptr</code> 来管理共享引用，也预留了个规划是未来可以改成非线程安全的引用来减少不必要的Cache Miss开销。</p></div><div class=article-more><a href=//owent.net/2025/2502.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2025-03-12T20:58:45.000+00:00 itemprop=datePublished>2025-03-12</time></div></div></article><article class="article-panel archive-article archive-type-2501"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2025/2501.html target=_blank itemprop=url>通用RPC代码生成器</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>我们项目组需要接入多种RPC接入和工具转换流程，并且每种接入层有自己的扩展和定制需求。为了提高开发效率，我们需要一个通用的RPC代码生成器，能够支持多种RPC接入层级的代码生成，同时支持自定义插件和模板。并且自由增加自定义插件而不需要变更构建系统流程。以便提供最佳的灵活性且能支持protobuf的所有特性。</p></div><div class=article-more><a href=//owent.net/2025/2501.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2025-02-13T17:06:45.000+00:00 itemprop=datePublished>2025-02-13</time></div></div></article><article class="article-panel archive-article archive-type-2405"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2024/2405.html target=_blank itemprop=url>实现strong_rc_ptr(比shared_ptr更快的引用计数智能指针)</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>我们的新项目有个比较复杂的全区全服交易行系统，其中搜索和推荐是高实时性全区服多维度排序的，并且要支持比较复杂的标签交集查询和属性范围查询的自由组合。
当有订单发生变化时，它不仅仅会影响全服状态下搜索和推荐条件的结果变化，也会同时影响商品维度的聚合，交易行层面的数据聚合。</p></div><div class=article-more><a href=//owent.net/2024/2405.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2024-10-08T20:45:45.000+00:00 itemprop=datePublished>2024-10-08</time></div></div></article><article class="article-panel archive-article archive-type-2404"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2024/2404.html target=_blank itemprop=url>手夯一个STL allocator和对象内存分析组件</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>我们项目组前段时间排查和分析压测环境下的某些业务模块大量索引结构的内存问题。通用的工具比如 <a href=https://github.com/jemalloc/jemalloc>jemalloc+jeperf</a> 或者 <a href=https://github.com/google/tcmalloc>tcmalloc+gperf</a> 的组合过于底层，一方面开启跟踪开销较高，另一方面也是会产生过多噪音数据影响判断。所以我针对我们的智能指针（包含 <code>std::shared_ptr</code> 和我最近写了个非线程安全的版本的 <code>strong_rc_ptr</code> ， 这个后面有空再分享）和STL容器实现了allocator来帮助动态的手动插桩来分析问题。
最终的效果是可以通过一键替换类型申明的Allocator来插入动态控制和插桩统计的能力，这里分享一下手夯标准STL allocator的一些实现细节，方便其他小伙伴如果需要做类似的实现来参考。</p></div><div class=article-more><a href=//owent.net/2024/2404.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2024-08-21T23:51:45.000+00:00 itemprop=datePublished>2024-08-21</time></div></div></article><article class="article-panel archive-article archive-type-2403"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2024/2403.html target=_blank itemprop=url>std::condition_variable 的信号丢失问题</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>这篇分享拖更了好久了。问题起源于去年我们项目组接入 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 的时候，在进程优雅退出的时候偶现超时，虽然可以直接kill进程没啥影响但是退出不“优雅”的话总归会破坏发布流程，增加人工介入的成本。这里记录一下问题可能其他的组件有类似的用法也会有相似的问题。</p></div><div class=article-more><a href=//owent.net/2024/2403.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2024-08-02T15:30:45.000+00:00 itemprop=datePublished>2024-08-02</time></div></div></article><article class="article-panel archive-article archive-type-2402"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2024/2402.html target=_blank itemprop=url>踩坑一处（GCC）STL `std::async` 实现BUG导致的crash问题</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>近期发现项目组使用新版本的 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 的时候偶现崩溃。崩溃的位置在STL的 <code>std::future</code> 析构的地方，而这个 <code>std::future</code> 由 <code>std::async</code>创建。
比较违反直觉，这里记录分享一下分析和解决过程方面其他碰到的小伙伴们。</p></div><div class=article-more><a href=//owent.net/2024/2402.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2024-07-21T02:32:45.000+00:00 itemprop=datePublished>2024-07-21</time></div></div></article><article class="article-panel archive-article archive-type-2402"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2024/2401.html target=_blank itemprop=url>GCC 14的一个warning to error BUG</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>早先社区报过 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 在GCC 14中编译不通过的问题。最近我也是先升级我们项目组的工具链，主要也是把GCC升级到GCC 14，这时候发现有些第三方工具构建失败。
这里记录一下以防后续其他人碰到参考。</p></div><div class=article-more><a href=//owent.net/2024/2401.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2024-05-30T20:39:45.000+00:00 itemprop=datePublished>2024-05-30</time></div></div></article><article class="article-panel archive-article archive-type-2310"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2309.html target=_blank itemprop=url>给xresloader（Excel导表工具）增强UE读表支持（包含蓝图,Blueprint）</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://xresloader.atframe.work/>xresloader</a> 是一组用于把Excel数据结构化并导出为程序可读的数据文件的导表工具集。它包含了一系列跨平台的工具、协议描述和数据读取代码。</p><p>主要功能特点：</p><ul><li>跨平台（java 11 or upper）</li><li>Excel => protobuf/msgpack/lua/javascript/json/xml</li><li>完整支持协议结构，包括嵌套结构和数组嵌套</li><li>同时支持protobuf proto v2 和 proto v3</li><li>支持导出proto枚举值到lua/javascript代码和json/xml数据</li><li>支持导出proto描述信息值到lua/javascript代码和json/xml数据（支持自定义插件，方便用户根据proto描述自定义反射功能）</li><li>支持导出 UnrealEngine 支持的json或csv格式，支持自动生成和导出 UnrealEngine 的 <code>DataTable</code> 加载代码</li><li>支持别名表，用于给数据内容使用一个易读的名字</li><li>支持验证器，可以在数据里直接填写proto字段名或枚举名，或者验证填入数据的是否有效</li><li>支持通过protobuf协议插件控制部分输出</li><li>支持自动合表，把多个Excel数据表合并成一个输出文件</li><li>支持公式</li><li>支持oneof,支持plain模式输入字符串转为数组或复杂结构,支持map</li><li>支持空数据压缩（裁剪）或保留定长数组</li><li>支持基于正则表达式分词的字段名映射转换规则</li><li>支持设置数据版本号</li><li>Lua输出支持全局导出或导出为 <code>require</code> 模块或导出为 <code>module</code> 模块。</li><li>Javascript输出支持全局导出或导出为 <code>nodejs</code> 模块或导出为 <code>AMD</code> 模块。</li><li>提供CLI批量转换工具（支持python 2.7/python 3 @ Windows、macOS、Linux）</li><li>提供GUI批量转换工具（支持Windows、macOS、Linux）</li><li>CLI/GUI批量转换工具支持include来实现配置复用</li></ul><p><a href=https://xresloader.atframe.work/>xresloader</a> 包含了多个组件，其中最主要的部分分别是。</p></div><div class=article-more><a href=//owent.net/2023/2309.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-11-13T22:57:45.000+00:00 itemprop=datePublished>2023-11-13</time></div></div></article><article class="article-panel archive-article archive-type-2308"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2308.html target=_blank itemprop=url>Opentelemetry社区在gRPC的几个链接问题(静态库和动态库混用,musl工具链,符号裁剪)</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 在标准上报协议OTLP里是支持使用 <a href=https://github.com/grpc/grpc>gRPC</a> 作为传输协议的。但是，当 <a href=https://github.com/grpc/grpc>gRPC</a> 被作为静态库同时链接进多个动态库时，在一些平台上会有一些问题。这是 <a href=https://github.com/grpc/grpc>gRPC</a> 本身的一些实现方式导致的。
一直拖到今天才来比较完整得写这个问题的具体成因和解决方案，实际上也有一些其他库有相似实现的也会有相同的问题，所以分享出来看看有没有其他同学也可能碰到可以参考一下。</p></div><div class=article-more><a href=//owent.net/2023/2308.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-10-28T18:10:45.000+00:00 itemprop=datePublished>2023-10-28</time></div></div></article><article class="article-panel archive-article archive-type-2307"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2307.html target=_blank itemprop=url>Excel转表工具(xresloader)的新验证器（验证外部Excel和文本数据，唯一性和自定义规则）</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://xresloader.atframe.work/>xresloader</a> 是一组用于把Excel数据结构化并导出为程序可读的数据文件的导表工具集。它包含了一系列跨平台的工具、协议描述和数据读取代码。</p><p>主要功能特点：</p><ul><li>跨平台（java 11 or upper）</li><li>Excel => protobuf/msgpack/lua/javascript/json/xml</li><li>完整支持协议结构，包括嵌套结构和数组嵌套</li><li>同时支持protobuf proto v2 和 proto v3</li><li>支持导出proto枚举值到lua/javascript代码和json/xml数据</li><li>支持导出proto描述信息值到lua/javascript代码和json/xml数据（支持自定义插件，方便用户根据proto描述自定义反射功能）</li><li>支持导出 UnrealEngine 支持的json或csv格式，支持自动生成和导出 UnrealEngine 的 <code>DataTable</code> 加载代码</li><li>支持别名表，用于给数据内容使用一个易读的名字</li><li>支持验证器，可以在数据里直接填写proto字段名或枚举名，或者验证填入数据的是否有效</li><li>支持通过protobuf协议插件控制部分输出</li><li>支持自动合表，把多个Excel数据表合并成一个输出文件</li><li>支持公式</li><li>支持oneof,支持plain模式输入字符串转为数组或复杂结构,支持map</li><li>支持空数据压缩（裁剪）或保留定长数组</li><li>支持基于正则表达式分词的字段名映射转换规则</li><li>支持设置数据版本号</li><li>Lua输出支持全局导出或导出为 <code>require</code> 模块或导出为 <code>module</code> 模块。</li><li>Javascript输出支持全局导出或导出为 <code>nodejs</code> 模块或导出为 <code>AMD</code> 模块。</li><li>提供CLI批量转换工具（支持python 2.7/python 3 @ Windows、macOS、Linux）</li><li>提供GUI批量转换工具（支持Windows、macOS、Linux）</li><li>CLI/GUI批量转换工具支持include来实现配置复用</li></ul><p><a href=https://xresloader.atframe.work/>xresloader</a> 包含了多个组件，其中最主要的部分分别是。</p></div><div class=article-more><a href=//owent.net/2023/2307.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-08-20T00:19:45.000+00:00 itemprop=datePublished>2023-08-20</time></div></div></article><article class="article-panel archive-article archive-type-2306"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2306.html target=_blank itemprop=url>protobuf v22和gRPC v1.55版本升级的依赖变化和upb适配</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>近期的 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v22和 <a href=https://github.com/grpc/grpc>gRPC</a> v1.55 版本在构建流程层面引入了一些比较大的变化。
最初我关注到这个问题是在我参与的一个社区项目 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 的issue中（ <a href=https://github.com/open-telemetry/opentelemetry-cpp/issues/2095>https://github.com/open-telemetry/opentelemetry-cpp/issues/2095</a> ）。
直到后来，我们在自己的构建系统 <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> 对 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 和 <a href=https://github.com/grpc/grpc>gRPC</a> 也进行了升级。所以顺带给社区的项目也提交了一些相关的Patch，在这里分享一下可能其他同学也会碰到。</p></div><div class=article-more><a href=//owent.net/2023/2306.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-06-17T17:01:45.000+00:00 itemprop=datePublished>2023-06-17</time></div></div></article><article class="article-panel archive-article archive-type-2305"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2305.html target=_blank itemprop=url>关于protobuf近期版本（v20/v3.20+）和 gRPC v1.54版本在某些编译环境下的一些链接和编译问题</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>年初的时候我们项目组的构建系统( <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> )里把 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 升级到了 v20/v3.20 版本, <a href=https://github.com/grpc/grpc>gRPC</a> 也升级到了 v1.54 版本。然而这两个版本在Linux的ELF ABI和MacOS的Macho ABI下都出现了一些符号未定义的问题（当然也包含Android和iOS）。
这些问题也不仅限于 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> v20/v3.20 和 <a href=https://github.com/grpc/grpc>gRPC</a> v1.54，后续的版本有些修复了，有些没有。在官方完全修复之前，我们自己打了一些patch去修复这些问题。</p></div><div class=article-more><a href=//owent.net/2023/2305.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-06-16T22:25:45.000+00:00 itemprop=datePublished>2023-06-16</time></div></div></article><article class="article-panel archive-article archive-type-2304"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2304.html target=_blank itemprop=url>xresloader-Excel导表工具链的近期变更汇总</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://xresloader.atframe.work/>xresloader</a> 是一组用于把Excel数据结构化并导出为程序可读的数据文件的导表工具集。它包含了一系列跨平台的工具、协议描述和数据读取代码。</p><p>主要功能特点：</p><ul><li>跨平台（java 11 or upper）</li><li>Excel => protobuf/msgpack/lua/javascript/json/xml</li><li>完整支持协议结构，包括嵌套结构和数组嵌套</li><li>同时支持protobuf proto v2 和 proto v3</li><li>支持导出proto枚举值到lua/javascript代码和json/xml数据</li><li>支持导出proto描述信息值到lua/javascript代码和json/xml数据（支持自定义插件，方便用户根据proto描述自定义反射功能）</li><li>支持导出 UnrealEngine 支持的json或csv格式，支持自动生成和导出 UnrealEngine 的 <code>DataTable</code> 加载代码</li><li>支持别名表，用于给数据内容使用一个易读的名字</li><li>支持验证器，可以在数据里直接填写proto字段名或枚举名，或者验证填入数据的是否有效</li><li>支持通过protobuf协议插件控制部分输出</li><li>支持自动合表，把多个Excel数据表合并成一个输出文件</li><li>支持公式</li><li>支持oneof,支持plain模式输入字符串转为数组或复杂结构,支持map</li><li>支持空数据压缩（裁剪）或保留定长数组</li><li>支持基于正则表达式分词的字段名映射转换规则</li><li>支持设置数据版本号</li><li>Lua输出支持全局导出或导出为 <code>require</code> 模块或导出为 <code>module</code> 模块。</li><li>Javascript输出支持全局导出或导出为 <code>nodejs</code> 模块或导出为 <code>AMD</code> 模块。</li><li>提供CLI批量转换工具（支持python 2.7/python 3 @ Windows、macOS、Linux）</li><li>提供GUI批量转换工具（支持Windows、macOS、Linux）</li><li>CLI/GUI批量转换工具支持include来实现配置复用</li></ul><p><a href=https://xresloader.atframe.work/>xresloader</a> 包含了多个组件，其中最主要的部分分别是。</p></div><div class=article-more><a href=//owent.net/2023/2304.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-04-18T20:27:45.000+00:00 itemprop=datePublished>2023-04-18</time></div></div></article><article class="article-panel archive-article archive-type-2303"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2303.html target=_blank itemprop=url>打通游戏服务端框架的C++20协程改造的最后一环</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>我们终于在年初的时候最后完成了整体服务器框架对C++20协程的支持和接入。虽然之前陆陆续续抽时间改造一些组件，让它支持C++20协程，期间也记录了一些早期的设计思路和踩的坑（包括 <a href=https://owent.net/2020/2004.html>《libcopp接入C++20 Coroutine和一些过渡期的设计》</a>和<a href=https://owent.net/2022/2206.html>《libcopp对C++20协程的接入和接口设计》</a>），其中不乏一些C++20协程使用上可能打破我们常规思路细节和编译器的BUG。而且这些都是各个组件的改造，并没有最后整合到一起。</p></div><div class=article-more><a href=//owent.net/2023/2303.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-04-08T20:21:45.000+00:00 itemprop=datePublished>2023-04-08</time></div></div></article><article class="article-panel archive-article archive-type-2302"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2302.html target=_blank itemprop=url>Opentelemetry-cpp的Logs模块标准更新(涉及近期版本:1.8-1.9的BREAK CHANGES)</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p><a href=https://github.com/open-telemetry/opentelemetry-cpp>Opentelemetry-cpp</a> 是可观测领域，<a href=https://opentelemetry.io/>opentelemetry</a> (CNCF基金会孵化项目)的<a href=https://github.com/open-telemetry/opentelemetry-cpp>C++ SDK接入层</a>。
<a href=https://opentelemetry.io/>opentelemetry</a> 里面主要是分链路跟踪(Trace)、指标(Metrics)、日志(Logs)三大块。
同时 <a href=https://opentelemetry.io/>opentelemetry</a> 有一个标准规范文档 <a href=https://github.com/open-telemetry/opentelemetry-specification>opentelemetry-specification</a> ，而SDK实现主要就是来对这个标准规范文档的特定语言实现。
由于日志(Logs)这一块一直处于Experimental阶段，所以很长时间以来 <a href=https://github.com/open-telemetry/opentelemetry-cpp>C++ SDK接入层</a> 都没有及时更新跟进规范的变化。</p></div><div class=article-more><a href=//owent.net/2023/2302.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-02-25T11:39:45.000+00:00 itemprop=datePublished>2023-02-25</time></div></div></article><article class="article-panel archive-article archive-type-2301"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2023/2301.html target=_blank itemprop=url>给cmake-toolset和工具链(curl等)加HTTP/2和HTTP/3支持</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>前段时间集成一些公司内组件的时候发现它依赖 <a href=https://github.com/nghttp2/nghttp2.git>nghttp2</a> 。正好之前一直有给我的构建工具(<a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a>)里的构建 <a href=https://github.com/curl/curl.git>curl</a> 的流程加 HTTP/2 和 HTTP/3 的计划。
所以这波一次性搞定了。</p><h2 id=构建工具-cmake-toolset-和-curl>构建工具 <a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a> 和 <a href=https://github.com/curl/curl.git>curl</a></h2><p>首先，<a href=https://github.com/curl/curl.git>curl</a> 是支持多种第三方库作为 HTTP/2 和 HTTP/3（QUIC）算法库的。比如 <a href=https://github.com/ngtcp2/nghttp3.git>nghttp3</a>+<a href=https://github.com/ngtcp2/ngtcp2.git>ngtcp2</a>，或者微软家 <a href=https://github.com/microsoft/msquic>msquic</a>，或者Google家 <a href=https://github.com/google/quiche>quiche</a>。
其中HTTP/3只能选一个，互相是冲突的。而Google的<a href=https://github.com/google/quiche>quiche</a>官方仅有对bazel构建系统的支持，而我的<a href=https://github.com/atframework/cmake-toolset>cmake-toolset</a>是cmake生态的。
这里选用 <a href=https://github.com/ngtcp2/nghttp3.git>nghttp3</a>+<a href=https://github.com/ngtcp2/ngtcp2.git>ngtcp2</a> 的组合，主要是为了和其他的模块共享依赖。</p></div><div class=article-more><a href=//owent.net/2023/2301.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2023-01-30T11:39:45.000+00:00 itemprop=datePublished>2023-01-30</time></div></div></article><article class="article-panel archive-article archive-type-2210"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2210.html target=_blank itemprop=url>又开新坑之 coredns 插件: nftables和filter</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>传说中的下一代 <a href=https://nftables.org/projects/iptables/index.html>iptables</a> 的 <a href=https://nftables.org/projects/nftables/index.html>nftables</a> 已经出来了好长时间了。现在主流发行版的内核也都已经更新到了对 <a href=https://nftables.org/projects/nftables/index.html>nftables</a> 支持足够好的版本。
在2年多前我也初步体验过了 <a href=https://nftables.org/projects/nftables/index.html>nftables</a> ，当时写了个 <a href=https://owent.net/2020/2002.html>《nftables初体验》</a> 。并且开始使用 <a href=https://nftables.org/projects/nftables/index.html>nftables</a> 来实现对家里软路由的管理。
而去年的时候，我也尝试用 <a href=https://nftables.org/projects/nftables/index.html>nftables</a> 实现了双拨（详见: <a href=https://owent.net/2021/2104.html>《折腾一下nftables下的双拨》</a>）并且可以搭配TPROXY透明代理使用。</p></div><div class=article-more><a href=//owent.net/2022/2210.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-10-03T21:23:45.000+00:00 itemprop=datePublished>2022-10-03</time></div></div></article><article class="article-panel archive-article archive-type-2209"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2209.html target=_blank itemprop=url>关于opentelemetry-cpp社区对于C++ Head Only组件单例和符号可见性的讨论小记</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>前段时间有人在 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 提出了api组件在动态库中单例无法工作的 issue ，( <a href=https://github.com/open-telemetry/opentelemetry-cpp/issues/1520>https://github.com/open-telemetry/opentelemetry-cpp/issues/1520</a> ) 。</p><blockquote><p><a href=https://opentelemetry.io/>opentelemetry</a> 是可观测性领域的开源项目，目标是统一链路跟踪、数据指标和日志的服务、上报、协议和接口规范，目前属于 <a href=https://cncf.io/>CNCF基金会</a> 孵化项目。而 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 则是 <a href=https://opentelemetry.io/>opentelemetry</a> 中对标准规范SDK的C++实现。</p></div><div class=article-more><a href=//owent.net/2022/2209.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-10-02T20:43:45.000+00:00 itemprop=datePublished>2022-10-02</time></div></div></article><article class="article-panel archive-article archive-type-2207"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2208.html target=_blank itemprop=url>填个转表工具 xresloader 去年的坑（数组尾部裁剪）</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://github.com/xresloader/xresloader>xresloader</a> 是一个功能比较全面并且跨平台的Excel导出protobuf、msgpack、xml、lua、json、javascript、UE-Csv、UE-Json等数据格式的工具。
并且整个工具链还包含了基于模板引起生成读表代码的 <a href=https://github.com/xresloader/xres-code-generator>xres-code-generator</a> ，方便产品/策划使用的 <a href=https://github.com/xresloader/xresconv-gui>GUI批量执行工具 - xresconv-gui</a> 和方便CI集成和程序使用的 <a href=https://github.com/xresloader/xresconv-cli>命令行批量执行工具 - xresconv-cli</a>。</p></div><div class=article-more><a href=//owent.net/2022/2208.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-08-27T20:59:45.000+00:00 itemprop=datePublished>2022-08-27</time></div></div></article></div><hr><nav id=page-nav><ul class=pagination><li class='page-item disabled'><a class=page-link href=/categories/blablabla.html>1</a><span class=sr-only>(current)</span></li><li class=page-item><a class=page-link href=/categories/blablabla/page/2.html>2</a></li><li class=page-item><a class=page-link href=/categories/blablabla/page/3.html>3</a></li><li class=page-item><a class=page-link href=/categories/blablabla/page/4.html>4</a></li><li class=page-item><a class=page-link href=/categories/blablabla/page/5.html>5</a></li><li class=page-item><a class=page-link href=/categories/blablabla/page/6.html>6</a></li><li class=page-item><a class=page-link href=/categories/blablabla/page/2.html>下一页&#187;</a></li></ul></nav></section></div><footer id=footer><div class=outer><div id=footer-info class="inner clearfix"><strong id=footer-left class="float-left float-start"><a rel=license href=https://github.com/owent/blog-hugo/blob/master/LICENSE.md><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>2025&nbsp;OWenT
</strong><strong id=footer-right class="float-right float-end"><a href=https://beian.miit.gov.cn/ target=_blank>沪ICP备2022003252号</a>&nbsp;&nbsp;<a href=https://github.com/owent/blog-hugo target=_blank>本站源码</a>,
发布者 <a href=https://gohugo.io/ target=_blank>Hugo</a>,
主题 <a href=https://github.com/owent/hugo-theme-distinctionpp target=_blank>distinctionpp</a>
</strong><span class=clearfix></span></div></div></footer></div><script type=module>// import * as Popper from "@popperjs/core";// import * as bootstrap from "bootstrap";
// import React from "react";

        
</script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/highlight.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/awk.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/bash.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cpp.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/capnproto.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cmake.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/d.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/diff.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dockerfile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dos.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/erlang.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/go.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/less.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/llvm.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/lua.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/php.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/powershell.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/protobuf.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/python.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/profile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/typescript.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/vim.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/rust.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/yaml.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/@highlightjs/cdn-assets@latest/styles/vs2015.min.css",document.querySelector("head").appendChild(t),window.JSON?hljs.configure(JSON.parse('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}')):hljs.configure(evel('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}'));const n={};for(const e of hljs.listLanguages())n[e.toLowerCase()]=!0;for(const e of document.querySelectorAll("pre>code"))try{if(e.className.match(/\bmermaid\b/i)){e.classList.add("mermaid");continue}if(e.className.match(/\bnohighlight\b/i))continue;const t=e.className.match(/language-([^\s]+)/i);if(t&&t.length>=2&&hljs.getLanguage(t[1]))hljs.highlightElement(e);else{const t=hljs.highlightAuto(e.innerText,hljs.listLanguages());t&&t.value&&(e.innerHTML=t.value,e.classList.add("hljs"))}}catch(e){window.console&&console.log(e.toString()+`\r
Maybe can not detect the language`)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PQEY77BYG1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PQEY77BYG1")}</script><script type=text/javascript src=//unpkg.com/katex@latest/dist/katex.min.js></script><script type=text/javascript src=//unpkg.com/katex@latest/dist/contrib/auto-render.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/katex@latest/dist/katex.min.css",document.querySelector("head").appendChild(t),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1,ignoredTags:["script","noscript","style","textarea","pre","code"]})})</script><script type=text/javascript src=//unpkg.com/chart.js@latest/dist/chart.umd.js></script><script type=module>
import mermaid from "mermaid";
const config = {
    theme: 'neutral',
    logLevel: 'fatal',
    securityLevel: 'loose', 
    startOnLoad: true,
    arrowMarkerAbsolute: false,
    

};
mermaid.initialize(config);
</script><script type=text/javascript>var _hmt=_hmt||[];(function(){var t,n,e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6a0daf8d58889f1cf55a353867bfdbb0",t=document.getElementsByTagName("script"),n=document.getElementsByTagName("script")[t.length-1],n.parentNode.appendChild(e)})()</script></div></body></html>