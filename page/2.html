<!doctype html><html lang=zh-cn><head><meta name=generator content="Hugo 0.143.1"><meta charset=utf-8><title>I'm OWenT|I'm OWenT</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=canonical href=//owent.net/><link rel=alternate type=application/rss+xml href=//owent.net/index.xml title="I'm OWenT"><link rel=icon href=../favicon.ico><link rel=stylesheet href=//unpkg.com/bootstrap@latest/dist/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=//owent.net//css/style.css><link rel=stylesheet href=//owent.net/css/syntax.css><script type=importmap>
{
  "imports": {
    "react": "//unpkg.com/react@latest",
    "react-bootstrap": "//unpkg.com/react-bootstrap@latest",
    "mermaid": "//unpkg.com/mermaid@latest/dist/mermaid.esm.min.mjs",
    "bootstrap": "//unpkg.com/bootstrap@latest/dist/js/bootstrap.esm.min.js",
    "@popperjs/core": "//unpkg.com/@popperjs/core@latest/dist/esm/popper.js"
  }
}
</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8180054975285991" crossorigin=anonymous></script><meta content="codeva-4M5iohb9TW" name=baidu-site-verification></head><body><div id=container><div id=wrap><header id=header><div id=banner></div><div id=header-outer><div id=header-title><h1 id=site-title><a href=//owent.net/ id=logo>I'm OWenT</a></h1><h2 id=site-description>Challenge Everything</h2></div><div id=header-inner><nav id=main-nav class="navbar navbar-expand-md navbar-dark"><button class="navbar-toggler navbar-toggler-right" type=button data-bs-toggle=collapse data-bs-target=#main-nav-links aria-controls=main-nav-links aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<a id=main-nav-brand class="navbar-brand collapse" href=#>#</a><div class="collapse navbar-collapse position-relative" id=main-nav-links><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=../ title=Home>Home</a></li><li class=nav-item><a class=nav-link href=../archives.html title=Archives>Archives</a></li><li class=nav-item><a class=nav-link href=../about.html title=About>About</a></li><li class=nav-item><a id=nav-rss-link class=nav-link href=//owent.net/index.xml title=RSS订阅>RSS订阅</a></li></ul><div class="col-12 col-xl-2 col-lg-3 col-md-4" id=main-nav-search><form class=input-group method=get accept-charset=UTF-8 action=//www.bing.com/search><input type=hidden name=q1 value=site:owent.net>
<input class=form-control type=text placeholder=搜索 name=q>
<button class="btn btn-outline-secondary my-0" type=submit>搜索</button></form></div></div></nav></div></div></header><div id=main><section id=main-content><div id=index-content><article class="article-panel archive-article archive-type-2205"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2205.html target=_blank itemprop=url>再度优化GCC、LLVM、Clang、libc++、libc++abi等套件的构建脚本</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>一直以来，我都维护了完整的 <a href=https://github.com/owent-utils/bash-shell/tree/main/GCC%20Installer>GCC 工具链构建工具</a> 和 <a href=https://github.com/owent-utils/bash-shell/tree/main/LLVM%26Clang%20Installer>LLVM,Clang,libc++,libc++abi工具链构建工具</a> 。
一方面是为了测试和体验新版本编译器的功能和利用一些更现代化的工具检查代码中的风险，另一方面也是为了给我得很多开源仓库做多版本适配。
其中所有的编译期依赖项（不包括 tar,awk等可执行程序的工具）都是自己构建的，这样也能管理好某些新版本组件需要的新版本依赖项，并且做到跨发行版兼容。同时很多发行版自带的 LLVM+Clang 套件都缺斤少两，有的缺少 <code>clang-analyzer</code> ，有的缺少 <code>clang-format</code> ，也有的缺少 <code>libc++</code> 和 <code>libc++abi</code> 或者缺少sanitizer组件。我也是根据自己的需要编译并输出了大多数开发工具，甚至还有一些开发库以便二次开发（比如用libclang写工具来复用libcang的AST功能）。</p></div><div class=article-more><a href=//owent.net/2022/2205.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-04-17T23:43:45.000+00:00 itemprop=datePublished>2022-04-17</time></div></div></article><article class="article-panel archive-article archive-type-2204"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2204.html target=_blank itemprop=url>游戏服务的分布式事务优化（二）- 事务管理</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>接上文 <a href=https://owent.net/2022/2203.html>《游戏服务的分布式事务优化（一）- Write Ahead Log(WAL) 模块》</a></p><p>在挺久以前我写过一篇分享 <a href=https://owent.net/2020/2005.html>《在游戏服务器中使用分布式事务》</a> 。当时尝试在我们的游戏服务中引入TCC模型的分布式事务机制，以优化好友和公会服务的一致性流程。
最开始的实现并不通用，后来我对这个事务的实现做了进一步的优化和重构，抽离成了较为通用的模块，并对之前没全部完成的功能做了进一步完善。
此篇为重构内容的第二部分，主要聚焦于事务管理。</p></div><div class=article-more><a href=//owent.net/2022/2204.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-04-17T01:45:45.000+00:00 itemprop=datePublished>2022-04-17</time></div></div></article><article class="article-panel archive-article archive-type-2203"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2203.html target=_blank itemprop=url>游戏服务的分布式事务优化（一）- Write Ahead Log(WAL) 模块</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>在挺久以前我写过一篇分享 <a href=https://owent.net/2020/2005.html>《在游戏服务器中使用分布式事务》</a> 。当时尝试在我们的游戏服务中引入TCC模型的分布式事务机制，以优化好友和公会服务的一致性流程。
但是时间原因，但是写的第一版是深入我们当时的游戏业务的，第一版仅用在好友服上，既不通用测试也不完善。
后来逐渐把公会服务和聊天的功能也采用或部分采用这里的分布式事务的组件来实现，发现有大量的相似代码。
并且由于分布式事务的流程本身比较复杂，其他人接手的时候看起来就会比较吃力，所以我一直有计划重构这一块代码并且实现为更加通用且灵活的模块。
最近也是基本完成了这部分的工作，通用接口主要分为两部分。第一部分是 <strong>Write Ahead Log(WAL)</strong> 模块，第二部分是事务管理模块。
本此分享主要专注于第一部分 <strong>Write Ahead Log(WAL)</strong> 。</p></div><div class=article-more><a href=//owent.net/2022/2203.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-04-10T21:36:45.000+00:00 itemprop=datePublished>2022-04-10</time></div></div></article><article class="article-panel archive-article archive-type-2202"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2202.html target=_blank itemprop=url>记录一些bazel适配用编译选项</a></h1></header><div class=article-summary><p>之前搞 <a href=https://github.com/open-telemetry/opentelemetry-cpp>opentelemetry-cpp</a> 的时候接触了下 <a href=https://bazel.build/>bazel</a> 构建系统。这玩意儿用起来有一点坑，特别是使用自定义编译环境的时候。</p><p>在使用我自己编译的很新版本的 <a href=https://github.com/owent-utils/bash-shell/tree/main/GCC%20Installer>GCC</a> 和 <a href=https://github.com/owent-utils/bash-shell/tree/main/LLVM%26Clang%20Installer>clang+libc++</a> 的时候，涉及对libssp的检测和 <code>LD_LIBRARY_PATH</code> 环境变量在 <a href=https://bazel.build/>bazel</a> 中各个步骤中的传递，这里记录一下适配脚本。</p></div><div class=article-more><a href=//owent.net/2022/2202.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-02-14T20:36:45.000+00:00 itemprop=datePublished>2022-02-14</time></div></div></article><article class="article-panel archive-article archive-type-2201"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2022/2201.html target=_blank itemprop=url>测试现代化硬件C++浮点数性能和一致性</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>很久很久以前，浮点数的性能和跨平台跨硬件架构一致性是无法获得保证的，所以我们一般在需要强一致性和高性能的游戏服务器中会禁用浮点数，转而使用自己实现的定点数。
这么多年过去了，前段时间想看看现代化硬件下是否仍然有性能问题和是否能够保证一致性，做了些简单的测试，这里记录一下。</p></div><div class=article-more><a href=//owent.net/2022/2201.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2022-01-27T11:39:45.000+00:00 itemprop=datePublished>2022-01-27</time></div></div></article><article class="article-panel archive-article archive-type-2110"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2110.html target=_blank itemprop=url>适配Boringssl和OpenSSL 3.0</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://www.openssl.org/>openssl</a> 3.0发布好一阵子了，我的 <a href=https://github.com/atframework/atframe_utils>atframe_utils</a> 其实也挺早前就完成了对 <a href=https://www.openssl.org/>openssl</a> 3.0 和 <a href=https://github.com/google/boringssl>boringssl</a> 的适配。但是由于懒，一直没写这篇文章。在升级 [openssl] 3.0 和 <a href=https://github.com/google/boringssl>boringssl</a> 还是碰到了一些问题的，有些是由于接口变化，有些是由于功能支持还有些也和构建系统相关。还是有必要记录一下，至少能方便以后查找。</p></div><div class=article-more><a href=//owent.net/2021/2110.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-12-12T15:23:00.000+00:00 itemprop=datePublished>2021-12-12</time></div></div></article><article class="article-panel archive-article archive-type-2109"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2109.html target=_blank itemprop=url>近期cmake-toolset的一些适配问题</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>偷懒了好久没有写分享了，最近的时间也是花费了很多时间大量优化了之前游戏服务器框架和组件的很多细节。其中，相对独立且同时也被其他的项目使用的一个工具则是基于 <a href=https://cmake.org/>cmake</a> 和 <a href=https://git-scm.com/>git</a> 且兼容 <a href=https://vcpkg.io>vcpkg</a> 的构建系统 <a href=https://github.com/atframework/cmake-toolset/>cmake-toolset</a> 。之所以要写这么个构建工具主要是要提供比 <a href=https://vcpkg.io>vcpkg</a> 更宽容的兼容性（没办法我们公司的编译环境比较古老），并且提供更进一步的定制化能力（包含但不限于功能开关和下载源，这些东西 <a href=https://vcpkg.io>vcpkg</a> 也是很后期才有了个初步的支持）。那么先来记录一下构建系统适配过程中的一些问题吧。</p></div><div class=article-more><a href=//owent.net/2021/2109.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-12-05T20:10:00.000+00:00 itemprop=datePublished>2021-12-05</time></div></div></article><article class="article-panel archive-article archive-type-2108"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2108.html target=_blank itemprop=url>C++20 Text Formatting/fmtlib 适配问题小记</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>C++20 正式发布已经有一段时间了。其中 <code>Text Formatting</code> 是一个我个人比较感兴趣的新组件。它主要是解决了之前字符串格式化库 ( <code>printf</code> 系 ) 的效率问题和运行时安全的问题。
并且新的格式设置的形式也比较友好。相关规范和用法可以参见:</p></div><div class=article-more><a href=//owent.net/2021/2108.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-09-05T15:48:54.000+00:00 itemprop=datePublished>2021-09-05</time></div></div></article><article class="article-panel archive-article archive-type-2107"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2107.html target=_blank itemprop=url>再次重构LLVM+Clang+libcxx+libc++abi+其他相关工具的构建流程</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>我们有时候写一些基础性类库或者实验新功能的时候，常常需要使用到最新版本的GCC和Clang。一些Linux发行版的源里和一些工具链（比如MSYS2）里其实自带LLVM套件的包，<a href=https://llvm.org/>LLVM</a> 官网也提供一些常见平台的预编译包下载。
那为什么我们还要自己编译呢？如果有注意到的小伙伴可能会发现，很多平台的源和 <a href=https://llvm.org/>LLVM</a> 官网 里下载的预编译包，其实是缺失很多组件的。有些没有libc++和libc++abi（CentOS 8），有些没有Sanitizer相关的组件，有些缺失其他的组件。而Clang虽然支持GCC的libstdc++，但是一方面我们写基础性类库还是要优先考虑原生STL库的兼容性，另一方面Clang对libstdc++的支持也不是太好，特别是有些第三方库在这个组合下也是没有适配得很好，同时gdb和libc++的搭配有时候也不是很完善。
所以我们就需要一个组件尽可能开完整地包含LLVM，Clang,libc++,libc++abi还有其他周边工具（各类Sanitizer，clang-tiny,clang-analyzer等等）的工具链。</p></div><div class=article-more><a href=//owent.net/2021/2107.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-08-29T20:29:56.000+00:00 itemprop=datePublished>2021-08-29</time></div></div></article><article class="article-panel archive-article archive-type-2106"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2106.html target=_blank itemprop=url>重构基于CMake的构建工具链</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>对大型项目来说，必然会有很多的依赖项。特别是现代化的组件都会尝试去复用社区资源。而对于C/C++而言，依赖管理一直是一个比较头大的问题。
很多老式的系统和工具都会尝试去走相对标准化的安装过程，比如说用 <a href=https://linux.die.net/man/1/pkg-config>pkg-config</a> 或者用系统自带的包管理工具装在系统默认路径里。
当然这样很不方便，也不容易定制组件。我使用 <a href=https://cmake.org/>cmake</a> 比较多，所以一直以来在我的 <a href=https://github.com/atframework>atframework</a> 项目集中有一个 utility 项目 <a href=https://github.com/atframework/atframe_utils>atframe_utils</a>，里面包含一些常用的构建脚本。
并且在 <a href=https://github.com/atframework/atsf4g-co>atsf4g-co</a> 中实现了一些简单的包管理和构建流程。</p></div><div class=article-more><a href=//owent.net/2021/2106.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-06-05T22:38:45.000+00:00 itemprop=datePublished>2021-06-05</time></div></div></article><article class="article-panel archive-article archive-type-2105"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2105.html target=_blank itemprop=url>新版GCC和LLVM+Clang终于Release啦</a></h1></header><div class=article-summary><p>可能是疫情的原因，GCC好久没发布啦。最近总于又Release了，还是大版本。并且三大编译器对C++20的支持也都七七八八了。所以特意立贴庆祝一下，顺带更新一波构建脚本把这两年的一些改动列举一下。</p></div><div class=article-more><a href=//owent.net/2021/2105.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-05-16T14:34:34.000+00:00 itemprop=datePublished>2021-05-16</time></div></div></article><article class="article-panel archive-article archive-type-2104"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2104.html target=_blank itemprop=url>折腾一下nftables下的双拨</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>我们小区终于有联通线路啦，之前一直用的联通的手机号。它套餐满一定额度以后送一条宽带，本着不用白不用的精神，那必须不能浪费。还好我之前设置软路由得时候就预留了两个网口作wan，所以新增得联通得线路直接插那个口上就行了。（吐槽一下联通给得光猫竟然是8年前生产的老古董）</p></div><div class=article-more><a href=//owent.net/2021/2104.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-05-16T14:11:00.000+00:00 itemprop=datePublished>2021-05-16</time></div></div></article><article class="article-panel archive-article archive-type-2103"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2103.html target=_blank itemprop=url>[C++20] Module partitions和符号交叉引用（声明和实现分离）</a></h1></header><div class=article-summary><p>C++20 开始支持 <strong>Module</strong> 了。在以前C++为了解决循环依赖问题，经常会把类或者函数声明写前面，实现写后面。然后中间的代码就可以实现内部模块的内聚而互相引用。比如:</p></div><div class=article-more><a href=//owent.net/2021/2103.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-03-25T22:38:52.000+00:00 itemprop=datePublished>2021-03-25</time></div></div></article><article class="article-panel archive-article archive-type-2102"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2102.html target=_blank itemprop=url>[Rust] 实现一个线程安全且迭代器可以保存的链表</a></h1></header><div class=article-summary><h2 id=背景>背景</h2><p>今年有个想法，重新设计 <a href=https://github.com/atframework/libatbus>libatbus</a> 然后用 <a href=https://www.rust-lang.org/>Rust</a> 实现出来，然后可以加入一些云原生的支持。这需要一个定时器模块，我看了下 <a href=https://www.rust-lang.org/>Rust</a> 现有的几种定时器的实现，大多是基于堆或树的结构的，没有找到jiffies定时器的实现，所以想自己实现一个算了。这个定时器的实现又需要类似 C++ 的 <code>std::list::iterator</code> 的 <strong>插入和删除某个迭代器对其他迭代器没有影响</strong> 的特性，但是 <a href=https://www.rust-lang.org/>Rust</a> 的数据结构都不是这种设计模型。所以就决定自己写一个吧。</p></div><div class=article-more><a href=//owent.net/2021/2102.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-03-09T19:19:45.000+00:00 itemprop=datePublished>2021-03-09</time></div></div></article><article class="article-panel archive-article archive-type-2101"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2021/2101.html target=_blank itemprop=url>基于protobuf的代码生成</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>前段时间我用 <a href=https://www.python.org/>Python</a> 和 <a href=https://www.makotemplates.org/>Mako</a> 模板引擎重新梳理了我们项目中的一些重复的流程。重构了所有的RPC系统。这个工作其实完成了挺久了，但是迫于懒一直拖着没写完这篇记录，就一直没发。</p></div><div class=article-more><a href=//owent.net/2021/2101.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2021-02-09T11:39:45.000+00:00 itemprop=datePublished>2021-02-09</time></div></div></article><article class="article-panel archive-article archive-type-2009"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2020/2009.html target=_blank itemprop=url>几个使用protobuf中C++接口的Arena的坑</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p><a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 从3.0版本开始对C++增加了Arena接口，可以用于使用连续的内存块分配内部对象，并且可以更容易精确地控制对象地生命周期，最终达到减少内存碎片地目的。最近我给我们项目的部分接口流程进行相关地改造，在大多数使用 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 的地方都增加了对Arena的支持，但是在接入过程中也碰到了一些问题和坑。</p></div><div class=article-more><a href=//owent.net/2020/2009.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2020-11-10T16:35:33.000+00:00 itemprop=datePublished>2020-11-10</time></div></div></article><article class="article-panel archive-article archive-type-2008"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2020/2008.html target=_blank itemprop=url>Amazon Aurora DB存储引擎论文阅读小记</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>前段时间接触到腾讯云的一个新数据库产品 <a href=https://cloud.tencent.com/product/cynosdb>CynosDB</a> 是基于 <a href=https://aws.amazon.com/rds/aurora/>Amazon Aurora</a> 数据库的Paper实现的。我比较感兴趣就来看看它和之前看过的 <a href=https://ai.google/research/pubs/pub39966 title="Spanner: Google's Globally-Distributed Database">Spanner</a> 之类有什么不同，也许部分设计也能用在我们游戏业务的服务器中。它的主要的创新点在于重新设计了binlog和存储的部分，所以我也主要就看了两篇Paper： <a href=https://media.amazonwebservices.com/blog/2017/aurora-design-considerations-paper.pdf title="Amazon Aurora: Design Considerations for High Throughput Cloud-Native Relational Databases">《Amazon Aurora - Design Considerations for High Throughput Cloud-Native Relational Databases》</a> 是一个整体性质的介绍和概述； <a href=https://dl.acm.org/doi/abs/10.1145/3183713.3196937 title="Amazon Aurora: On Avoiding Distributed Consensus for I/Os, Commits, and Membership Changes">《Amazon Aurora: On Avoiding Distributed Consensus for I/Os,Commits, and Membership Changes》</a> 是对其重点部分的存储服务的。</p></div><div class=article-more><a href=//owent.net/2020/2008.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2020-11-07T19:27:08.000+00:00 itemprop=datePublished>2020-11-07</time></div></div></article><article class="article-panel archive-article archive-type-2007"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2020/2007.html target=_blank itemprop=url>近期对libatapp的一些优化调整(增加服务发现和连接管理,支持yaml等)</a></h1></header><div class=article-summary><p>最近给 <a href=https://github.com/atframework/libatapp>libatapp</a> 增加了一系列改造，非常多且琐碎，这里简单记录下吧。</p><p>首先是重构了配置管理。原来是手写在代码里的，因为原来上层的 <a href=https://github.com/atframework/libatbus>libatbus</a> 是不依赖 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 的，现在 既然已经依赖 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 了就转为 <a href=https://github.com/protocolbuffers/protobuf>protobuf</a> 管理了。同时现在还支持YAML配置，使用 <a href=https://github.com/jbeder/yaml-cpp>yaml-cpp</a> 来解析YAML文件，这个库也被一些其他知名的大型项目使用了，比如 <a href=https://www.envoyproxy.io/>Envoy proxy</a> 。 原来的conf/ini模式的配置也是支持的，现在加载配置的时候会尝试猜测以下配置文件是yaml还是conf/ini模式。 并且增加了统一的 <em>YAML转<a href=https://github.com/protocolbuffers/protobuf>protobuf</a></em> 、 <em>conf/ini转<a href=https://github.com/protocolbuffers/protobuf>protobuf</a></em> 和 <em>指定层级配置导出到<a href=https://github.com/protocolbuffers/protobuf>protobuf</a></em> 的接口来方便使用。比较特殊的是自定义日志配置后端的接入接口有了一些小变化，问题也不大。</p></div><div class=article-more><a href=//owent.net/2020/2007.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2020-10-04T15:43:17.000+00:00 itemprop=datePublished>2020-10-04</time></div></div></article><article class="article-panel archive-article archive-type-2006"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2020/2006.html target=_blank itemprop=url>xresloader转表工具链增加了一些新功能(map,oneof支持，输出矩阵，基于模板引擎的加载代码生成等)</a></h1></header><div class=article-summary><p><a href=https://github.com/xresloader/xresloader>xresloader</a> 是一组用于把Excel数据结构化并导出为程序可读的数据文件的导表工具集。它包含了一系列跨平台的工具、协议描述和数据读取代码。支持把Excel配置输出成 protobuf二进制、xml、json、lua、javascript、nodejs、msgpack、<a href=https://www.unrealengine.com/>UE</a>的Json格式及支持蓝图的代码、<a href=https://www.unrealengine.com/>UE</a>的Csv格式及支持蓝图的代码。</p></div><div class=article-more><a href=//owent.net/2020/2006.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2020-08-29T14:07:45.000+00:00 itemprop=datePublished>2020-08-29</time></div></div></article><article class="article-panel archive-article archive-type-2005"><div class="article-panel-inner archive-article-inner"><header class="article-header archive-article-title"><h1 itemprop=name><a class=article-title href=//owent.net/2020/2005.html target=_blank itemprop=url>在游戏服务器中使用分布式事务</a></h1></header><div class=article-summary><h2 id=前言>前言</h2><p>游戏业务通常有个特点是模块相关性非常高，模块之间的联动也非常密集且复杂。要保持各个相关模块的数据一致性，同时又兼顾效率和，没有一个通用的方法。通常的做法是走有损服务（也叫柔性服务）和自动修复的方式。比如支付服务一般的做法是在2PC的基础上增加redo log，对于发放和订单确认这两方，如果失败了会尝试几次补发。又或者好友系统或者公会，因为涉及多个对象的数据相互索引，一些做法是玩家在线的时候定期去检查数据是否正确，如果不正确走修复流程。</p></div><div class=article-more><a href=//owent.net/2020/2005.html target=_blank itemprop=url>更多</a></div><div class="article-panel-footer archive-article-footer"><time datetime=2020-06-27T12:19:45.000+00:00 itemprop=datePublished>2020-06-27</time></div></div></article></div><hr><nav id=page-nav><ul class=pagination><li class=page-item><a class=page-link href=../>&#171;上一页</a></li><li class=page-item><a class=page-link href=../>1</a></li><li class='page-item disabled'><a class=page-link href=../page/2.html>2</a><span class=sr-only>(current)</span></li><li class=page-item><a class=page-link href=../page/3.html>3</a></li><li class=page-item><a class=page-link href=../page/4.html>4</a></li><li class=page-item><a class=page-link href=../page/5.html>5</a></li><li class=page-item><a class=page-link href=../page/6.html>6</a></li><li class=page-item><a class=page-link href=../page/7.html>7</a></li><li class=page-item><a class=page-link href=../page/8.html>8</a></li><li class=page-item><a class=page-link href=../page/9.html>9</a></li><li class=page-item><a class=page-link href=../page/10.html>10</a></li><li class=page-item><a class=page-link href=../page/11.html>11</a></li><li class=page-item><a class=page-link href=../page/12.html>12</a></li><li class=page-item><a class=page-link href=../page/13.html>13</a></li><li class=page-item><a class=page-link href=../page/3.html>下一页&#187;</a></li></ul></nav></section></div><footer id=footer><div class=outer><div id=footer-info class="inner clearfix"><strong id=footer-left class="float-left float-start"><a rel=license href=https://github.com/owent/blog-hugo/blob/master/LICENSE.md><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>2025&nbsp;OWenT
</strong><strong id=footer-right class="float-right float-end"><a href=https://beian.miit.gov.cn/ target=_blank>沪ICP备2022003252号</a>&nbsp;&nbsp;<a href=https://github.com/owent/blog-hugo target=_blank>本站源码</a>,
发布者 <a href=https://gohugo.io/ target=_blank>Hugo</a>,
主题 <a href=https://github.com/owent/hugo-theme-distinctionpp target=_blank>distinctionpp</a>
</strong><span class=clearfix></span></div></div></footer></div><script type=module>// import * as Popper from "@popperjs/core";// import * as bootstrap from "bootstrap";
// import React from "react";

        
</script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/highlight.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/awk.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/bash.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cpp.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/capnproto.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cmake.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/d.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/diff.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dockerfile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dos.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/erlang.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/go.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/less.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/llvm.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/lua.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/php.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/powershell.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/protobuf.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/python.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/profile.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/typescript.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/vim.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/rust.min.js></script><script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/yaml.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/@highlightjs/cdn-assets@latest/styles/vs2015.min.css",document.querySelector("head").appendChild(t),window.JSON?hljs.configure(JSON.parse('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}')):hljs.configure(evel('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}'));const n={};for(const e of hljs.listLanguages())n[e.toLowerCase()]=!0;for(const e of document.querySelectorAll("pre>code"))try{if(e.className.match(/\bmermaid\b/i)){e.classList.add("mermaid");continue}if(e.className.match(/\bnohighlight\b/i))continue;const t=e.className.match(/language-([^\s]+)/i);if(t&&t.length>=2&&hljs.getLanguage(t[1]))hljs.highlightElement(e);else{const t=hljs.highlightAuto(e.innerText,hljs.listLanguages());t&&t.value&&(e.innerHTML=t.value,e.classList.add("hljs"))}}catch(e){window.console&&console.log(e.toString()+`\r
Maybe can not detect the language`)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PQEY77BYG1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PQEY77BYG1")}</script><script type=text/javascript src=//unpkg.com/katex@latest/dist/katex.min.js></script><script type=text/javascript src=//unpkg.com/katex@latest/dist/contrib/auto-render.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="//unpkg.com/katex@latest/dist/katex.min.css",document.querySelector("head").appendChild(t),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1,ignoredTags:["script","noscript","style","textarea","pre","code"]})})</script><script type=text/javascript src=//unpkg.com/chart.js@latest/dist/chart.umd.js></script><script type=module>
import mermaid from "mermaid";
const config = {
    theme: 'neutral',
    logLevel: 'fatal',
    securityLevel: 'loose', 
    startOnLoad: true,
    arrowMarkerAbsolute: false,
    

};
mermaid.initialize(config);
</script><script type=text/javascript>var _hmt=_hmt||[];(function(){var t,n,e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6a0daf8d58889f1cf55a353867bfdbb0",t=document.getElementsByTagName("script"),n=document.getElementsByTagName("script")[t.length-1],n.parentNode.appendChild(e)})()</script></div></body></html>