<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>Blog切换到Hugo|I'm OWenT</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=canonical href=//owent.net/2017/1467.html><link href=//owent.net/index.xml rel=alternate type=application/rss+xml title="I'm OWenT"><link rel=icon href=../favicon.ico><link rel=stylesheet href=//unpkg.com/bootstrap@latest/dist/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=//owent.net/css/style.css><script type=text/javascript src=//unpkg.com/jquery@latest/dist/jquery.slim.min.js crossorigin=anonymous></script>
<link rel=stylesheet href=//owent.net/css/syntax.css></head><body><div id=container><div id=wrap><header id=header><div id=banner></div><div id=header-outer><div id=header-title><h1 id=site-title><a href=//owent.net id=logo>I'm OWenT</a></h1><h2 id=site-description>Challenge Everything</h2></div><div id=header-inner><nav id=main-nav class="navbar navbar-expand-md navbar-dark"><button class="navbar-toggler navbar-toggler-right" type=button data-toggle=collapse data-target=#main-nav-links aria-controls=main-nav-links aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button>
<a id=main-nav-brand class="navbar-brand collapse" href=#>#</a><div class="collapse navbar-collapse position-relative" id=main-nav-links><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=../ title=Home>Home</a></li><li class=nav-item><a class=nav-link href=../archives.html title=Archives>Archives</a></li><li class=nav-item><a class=nav-link href=../about.html title=About>About</a></li><li class=nav-item><a id=nav-rss-link class=nav-link href=//owent.net/index.xml title=RSS订阅>RSS订阅</a></li></ul><div class="col-2 position-absolute end-0"><form class=input-group method=get accept-charset=utf-8 action=//www.bing.com/search><input type=hidden name=q1 value=site:owent.net>
<input class=form-control type=text placeholder=搜索 name=q>
<button class="btn btn-outline-secondary my-2 my-sm-0" type=submit>搜索</button></form></div></div></nav></div></div></header><div id=main><section id=main-content><div id=post-content><article id=post-8fe944def3799fd59b3efe871603442a class="article-panel article article-type-post" itemscope itemprop=blogPost><div class="article-panel-inner article-inner"><div class=article-inner><header class=article-header><h1 itemprop=name><a class=article-title href=//owent.net/2017/1467.html target=_blank itemprop=url>Blog切换到Hugo</a></h1></header><hr><div id=toc class="well toc m-3 p-1 pr-1 pt-1 pb-2 float-md-right float-md-end"><nav id=TableOfContents><ul><li><a href=#框架设计>框架设计</a></li><li><a href=#移植主题>移植主题</a></li><li><a href=#添加-mathjaxkatex-支持>添加 MathJax/KaTex 支持</a></li><li><a href=#代码高亮>代码高亮</a></li><li><a href=#搜索>搜索</a></li><li><a href=#评论>评论</a></li><li><a href=#后遗症>后遗症</a></li></ul></nav></div><br><div class=article-entry itemprop=articleBody><p>其实很早就想把Blog迁移到静态化的博客系统了。不过一直没花时间来搞，当然主要原因还是懒。</p><p>这次下决心搞主要是因为，之前VPS迁移到Vultr，然后它的主机默认是没有交换区的。后来老是收到网站崩溃告警，每次去看都是MariaDB挂掉了，然后查了一下是内存不足。
然后，调整了几次参数，发现都不能解决问题。我这么个小站搞个高配机器显然是浪费。这种小网站都能耗尽1GB的内存我也是醉了。所以后来就干脆迁移到静态博客系统算了。</p><h2 id=框架设计>框架设计</h2><p>其实本来有两个备选方案。一个是国人写得<a href=https://hexo.io/>Hexo</a>，另一个是<a href=https://gohugo.io/>Hugo</a>。<a href=https://jekyllrb.com/>Jekyll</a>不在考虑之列，因为我对ruby不熟并且没有兴趣。以前玩过<a href=https://jekyllrb.com/>Jekyll</a>，感觉还是太折腾了。特别是国内还得换源什么的。</p><p>不过单单就<a href=https://hexo.io/>Hexo</a>和<a href=https://gohugo.io/>Hugo</a>的框架设计来说，我觉得是<a href=https://hexo.io/>Hexo</a>远胜于<a href=https://gohugo.io/>Hugo</a>的。因为<a href=https://hexo.io/>Hexo</a>有更完整的插件机制，主题机制。它的插件机制可以让你替换里面的核心组件，增加更多的渲染引擎、模板引擎等等。并且可以和nodejs的很多工具配合起来用，非常方便。这样主题作者和插件作者都能用自己的习惯和熟悉的工具链来开发。比如你可以用sass或者less来写css，然后也可以不用默认的模板引擎ejs，很多人的主题用jade的。甚至可以换掉Markdown引擎，增加更多的Markdown功能进去。也可以在很多事件点插入和修改生成的HTML，来插入一些功能。</p><p>相比之下<a href=https://gohugo.io/>Hugo</a>就差多了。压根没有插件机制，干啥都得主题自己做。读配置也写得比较死，很不方便。比如<a href=https://hexo.io/>Hexo</a>可以给主题加配置，然后有主题配置和站点配置，但是<a href=https://gohugo.io/>Hugo</a>就没法读取主题配置。另外<a href=https://gohugo.io/>Hugo</a>的模板引擎只能用Go语言的<a href=http://golang.org/pkg/html/template/>HTML template</a>。哇这货难用的屎一样。语法就像是要你自己写逆波兰式。自己写树形结构。不过就像<a href=https://gohugo.io/>Hugo</a>自己说的，它这个静态网站生成系统非常地快。确实很快，比<a href=https://hexo.io/>Hexo</a>快多了。而且它的Star数量也赶超了<a href=https://hexo.io/>Hexo</a>。</p><p>不过我觉得<a href=https://gohugo.io/>Hugo</a>比<a href=https://hexo.io/>Hexo</a>活跃的原因并不是因为它快。我觉得对于静态网站生成来说，这点性能并不是特别重要。而且<a href=https://hexo.io/>Hexo</a>的生成速度也可以接受，至少它比<a href=https://www.gitbook.com/>gitbook</a>快多了。真正制约<a href=https://hexo.io/>Hexo</a>发展的应该是文档。作为一个开源项目而言，文档及其重要。而<a href=https://hexo.io/>Hexo</a>很多重要部分API的文件，根本找不到。比如它说一些事件里的回调参数是Data类型，然后我并没有在哪里找到Data类型是个啥，里面有什么。写插件和主题的时候全靠看别人的怎么写，然后试。这太伤了。相比之下,<a href=https://gohugo.io/>Hugo</a>的文档就完善得多得多得多。虽然也有些地方的找别人主题的参考实现，但是基本上从复杂到小白的文档都覆盖得比较完整。</p><p>现在我也说不上来这两个那个更有前景，<a href=https://hexo.io/>Hexo</a>还差很多文档和事件响应目前给了裸HTML，虽然能用而且很自由，但是操作起来其实很不方便，缺乏最佳实践。而<a href=https://gohugo.io/>Hugo</a>目前缺失插件机制，而且很多配置和参数写得很死。</p><p>我迁移到静态博客系统主要是复刻主题。所以两个系统的主题都复刻了一遍，主框架是一样的，但是用了兼容两者的写法和配置吧。</p><h2 id=移植主题>移植主题</h2><p>我的Wordpress的博客用得是自己写得主题<a href=https://github.com/owent/distinctionpp>distinctionpp</a>。所以复刻了两个系统的主题：</p><ul><li><a href=https://github.com/owent/hexo-theme-distinctionpp>hexo-theme-distinctionpp</a></li><li><a href=https://github.com/owent/hugo-theme-distinctionpp>hugo-theme-distinctionpp</a></li></ul><p>两个主题的功能和内容基本是保持一致的，除了有些无法实现的功能。比如<a href=https://gohugo.io/>Hugo</a>很难支持把&lt;!&ndash; toc &ndash;>转为目录，只能固定地给所有文章开头加目录。</p><p>然后在原有的主题上有做了更进一步地精简，裁剪加载文件大小和把一些图片换成纯CSS3实现，再就是微调一些样式。</p><p>然后顺便更新了下依赖库啥的，我毕竟不是搞前端的，所以懒得搞这种UI布局之类的东西，就直接用<a href=https://v4-alpha.getbootstrap.com/>bootstrap</a>了。不过我用的<a href=https://v4-alpha.getbootstrap.com/>bootstrap</a>的4.0，4.0必须加载它的js文件，而且还依赖<a href=https://hexo.io/>tether</a>，也导致多加载了几个文件。</p><p>不过直接能用<a href=https://v4-alpha.getbootstrap.com/>bootstrap</a>的响应式布局还是蛮舒服的。以前的<a href=https://github.com/owent/distinctionpp>distinctionpp</a>主题的手机上显示还是看着蛮不爽的。而且现在还可以全部用相对大小，不再用px了。而且都不需要我自己去细调。</p><p>顺便学了下用<a href=http://sass-lang.com/>sass</a>来写css，其实和以前<a href=http://lesscss.org/>less</a>差不太多。只不过<a href=https://v4-alpha.getbootstrap.com/>bootstrap</a>开始转用<a href=http://sass-lang.com/>sass</a>了而且似乎现在<a href=http://lesscss.org/>less</a>并没有<a href=http://sass-lang.com/>sass</a>活跃。而且导入<a href=http://sass-lang.com/>sass</a>之后还能使用一些bootstrap定义的函数什么的。还算方便吧。</p><p>接下来还有一些额外的功能得添加和替换，毕竟静态博客和动态网站还是有一些限制的。</p><h2 id=添加-mathjaxkatex-支持>添加 MathJax/KaTex 支持</h2><p><a href=https://www.mathjax.org/>MathJax</a>和<a href=https://github.com/Khan/KaTeX>KaTex</a>主要用来用Latex写公式。</p><p>这个在<a href=https://hexo.io/>Hexo</a>里很方便，有人写了插件，安装就行了。但是<a href=https://gohugo.io/>Hugo</a>就得自己集成了，还好反正不困难。然后我的Blog就支持公式了。并且我把以前一些文章的内容改成了公式。好看多了。</p><h2 id=代码高亮>代码高亮</h2><p>原先我是写了Wordpress插件<a href=https://github.com/owent/WP-Code-Highlight.js>WP-Code-Highlight.js</a>。这里我就直接集成到主题里去了。而且也没其他什么很好的方法。两个系统自带的高亮都很渣，插件兼容性很糟糕。</p><h2 id=搜索>搜索</h2><p>静态博客没有搜索功能嘛，所以我研究了下通过GET请求到搜索引擎来做站内搜索。但是有一些搜索引擎其实提供Search Box的功能，供你在网站里集成站内搜索，比如Google和DuckDuckGo。我看过最好的还是Google,但是国内Google太不稳定，所以我还是用了Bing的GET请求。目前主题里都是用的请求跳转到搜索引擎，不过说不定哪天我会有兴趣集成Search Box。</p><p>这里先记下其他搜索引擎的参数：</p><ul><li>Google<ul><li>Search Box: <a href=https://cse.google.com>https://cse.google.com</a></li><li>URL: //google.com/search</li><li>搜索词参数: q=搜索内容</li><li>站内限制参数: sitesearch=域名</li></ul></li><li>Bing<ul><li><a href=https://blogs.msdn.microsoft.com/zxue/2009/07/31/adding-microsoft-bing-to-your-web-site/>https://blogs.msdn.microsoft.com/zxue/2009/07/31/adding-microsoft-bing-to-your-web-site/</a></li><li>URL: //www.bing.com/search</li><li>搜索词参数: q=搜索内容</li><li>站内限制参数: q1=site:域名</li></ul></li><li>DuckDuckGo<ul><li>Search Box: <a href=https://duckduckgo.com/search_box>https://duckduckgo.com/search_box</a></li><li><a href=http://patdryburgh.com/blog/adding-a-custom-duckduckgo-search-bar-to-your-site/>http://patdryburgh.com/blog/adding-a-custom-duckduckgo-search-bar-to-your-site/</a></li><li><a href=http://duckduckgo.com/params.html>http://duckduckgo.com/params.html</a></li><li>URL: //duckduckgo.com/</li><li>搜索词参数: q=搜索内容</li><li>站内限制参数: sites=域名</li></ul></li><li>Baidu<ul><li>Search Box: <a href=http://zhanzhang.baidu.com/guide/index>http://zhanzhang.baidu.com/guide/index</a></li><li><a href="http://zn.baidu.com/cse/wiki/index?category_id=25">http://zn.baidu.com/cse/wiki/index?category_id=25</a></li><li>URL: //zhannei.baidu.com/cse/site</li><li>搜索词参数: query=搜索内容</li><li>站内限制参数: cc=域名</li><li>百度的所有者验证不支持301跳转，我的Blog会HTTP强制301跳转到HTTPS的链接。导致我一直验证不成功，真是渣渣。</li></ul></li><li>Sogou<ul><li><a href=http://fuwu.sogou.com/daima/code.html>http://fuwu.sogou.com/daima/code.html</a></li><li>URL: //www.sogou.com/web</li><li>搜索词参数: query=搜索内容</li><li>站内限制参数: insite=域名</li></ul></li></ul><h2 id=评论>评论</h2><p>评论系统也是蛮麻烦的，之前国内的多说已经关闭了。我看了下别人说的其他家也不是很好用。</p><p>不过我之前看到过有人做了用Github的Issue来做评论系统的，之前star了<a href=https://github.com/imsun/gitment>gitcomment</a>，就试了一下。我的主题里是集成了这个，但是这个和另一个俄罗斯小朋友写得系统一样，要求评论者必须授权Application对Public仓库的完整读写权限（包括但不限于代码、Wiki和issues）。不过<a href=https://github.com/imsun/gitment>gitcomment</a>作者也说了，github没有提供更系粒度的权限了，所以这已经是要的最小的权限了,但是读权限就算了，还必须给写权限，我还是觉得有点不靠谱，所以我自己妹妹有用，测试完就关掉配置了，其他人谁想用倒是可以打开。</p><p>最终还是回归<a href=https://disqus.com/>disqus</a>。无奈这货在国内被墙。唉，反正上我blog还会回复的应该都是程序员了吧？程序员翻墙不是难事吧？所以不管了先还是<a href=https://disqus.com/>disqus</a>吧。</p><h2 id=后遗症>后遗症</h2><p>这个换完系统其实还是蛮伤的，一个是之前的评论我先吧重要的补到原来的文章里了，不重要的就丢了。
然后哪些迁移工具导出的Markdown多多少少有问题，所以我挨个过了一遍。
再就是原来的地址都失效了，站点地图内容也全部变了，估计搜索引擎会发现很多死链，不知道啥时候才能刷新完。
至于文章的超链接，我自己Blog里互相引用的我是过了一遍改掉了，外部的引用我就没办法了。而且懒得复原原来的短连接了，新的链接模式都很短。</p><p>不过也算是一劳永逸吧，所以文章都变成Markdown，以后都很容易转换和导出导入。不再需要数据库了，我觉得我的VPS又可以降级了。嘿，便宜才是硬道理。</p></div><hr><footer class=article-footer><div class="article-panel-footer article-meta article-footer clearfix"><span class=article-meta-left><ol><li><a href=//owent.net/categories/article.html>Article</a></li><li><a href=//owent.net/categories/blablabla.html>Blablabla</a></li></ol></span><span class=article-meta-right><time datetime=2017-07-17T12:33:44.000+00:00 itemprop=datePublished>2017-07-17</time></span>
<span class=clearfix></span></div></footer></div><hr><nav id=article-nav><ul class=pagination><li class=page-item><a class=page-link id=article-nav-newer class=article-nav-link-wrap href=//owent.net/2017/1468.html>上一篇<strong>整理一波软件源镜像同步工具+DevOps工具</strong></a></li><li class=page-item><a class=page-link id=article-nav-older class=article-nav-link-wrap href=//owent.net/2017/1466.html>下一篇<strong>libcopp v2的第一波优化完成</strong></a></li></ul></nav><hr><section id=comments><div id=disqus_thread></div><script type=text/javascript>var disqus_config=function(){this.page.identifier="1467"};(function(){var e=document,t=e.createElement("script");t.src="https://owent.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></section></div></article></div></section></div><footer id=footer><div class=outer><div id=footer-info class="inner clearfix"><strong id=footer-left class="float-left float-start"><a rel=license href=https://github.com/owent/blog-hugo/blob/master/LICENSE.md><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>
2022
OWenT</strong>
<strong id=footer-right class="float-right float-end"><a href=https://github.com/owent/blog-hugo target=_blank>本站源码</a>,
发布者 <a href=https://gohugo.io/ target=_blank>Hugo</a>,
主题 <a href=https://github.com/owent/hugo-theme-distinctionpp target=_blank>distinctionpp</a></strong>
<span class=clearfix></span></div></div></footer></div><script type=text/javascript src=//unpkg.com/@popperjs/core@latest/dist/umd/popper.min.js crossorigin=anonymous></script>
<script type=text/javascript src=//unpkg.com/bootstrap@latest/dist/js/bootstrap.min.js crossorigin=anonymous></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/highlight.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/bash.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cpp.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/capnproto.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/cmake.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/d.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/diff.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/dos.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/erlang.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/go.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/less.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/lua.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/php.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/powershell.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/protobuf.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/python.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/profile.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/typescript.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/vim.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/rust.min.js></script>
<script type=text/javascript src=//unpkg.com/@highlightjs/cdn-assets@latest/languages/yaml.min.js></script>
<script type=text/javascript>jQuery(function(){jQuery("head").append('<link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@latest/styles/vs2015.min.css" />'),window.JSON?hljs.configure(JSON.parse('{"languages":{},"tabreplace":"    ","usebr":false}')):hljs.configure(evel('{"languages":{},"tabreplace":"    ","usebr":false}')),jQuery("pre\u003ecode").each(function(e,t){try{hljs.highlightBlock(t)}catch(e){window.console&&console.log(e.toString()+`
Maybe can not detect the language`)}})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-19298704-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-19298704-1")</script><script type=text/javascript src=//unpkg.com/katex@latest/dist/katex.min.js></script>
<script type=text/javascript src=//unpkg.com/katex@latest/dist/contrib/auto-render.min.js></script>
<script type=text/javascript>jQuery(function(){jQuery("head").append('<link rel="stylesheet" href="//unpkg.com/katex@latest/dist/katex.min.css" />'),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],ignoredTags:["script","noscript","style","textarea","pre","code"]})})</script><script type=text/javascript src=//unpkg.com/chart.js@latest/dist/chart.min.js></script>
<script type=text/javascript src=//unpkg.com/mermaid@latest/dist/mermaid.min.js></script></div></body></html>