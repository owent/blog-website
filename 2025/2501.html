<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>通用RPC代码生成器|I'm OWenT</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=canonical href=//owent.net/2025/2501.html><link rel=icon href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=//owent.net//css/style.css><link rel=stylesheet href=//owent.net/css/syntax.css><script type=importmap>
{
  "imports": {
    "react": "https://cdn.jsdelivr.net/npm/react/+esm",
    "react-bootstrap": "https://cdn.jsdelivr.net/npm/react-bootstrap/+esm",
    "mermaid": "https://cdn.jsdelivr.net/npm/mermaid/+esm",
    "bootstrap": "https://cdn.jsdelivr.net/npm/bootstrap/+esm",
    "@popperjs/core": "https://cdn.jsdelivr.net/npm/popper.js/+esm"
  }
}
</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8180054975285991" crossorigin=anonymous></script><meta content="codeva-4M5iohb9TW" name=baidu-site-verification></head><body><div id=container><div id=wrap><header id=header><div id=banner></div><div id=header-outer><div id=header-title><h1 id=site-title><a href=//owent.net/ id=logo>I'm OWenT</a></h1><h2 id=site-description>Challenge Everything</h2></div><div id=header-inner><nav id=main-nav class="navbar navbar-expand-md navbar-dark"><button class="navbar-toggler navbar-toggler-right" type=button data-bs-toggle=collapse data-bs-target=#main-nav-links aria-controls=main-nav-links aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<a id=main-nav-brand class="navbar-brand collapse" href=#>#</a><div class="collapse navbar-collapse position-relative" id=main-nav-links><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/index.html title=Home>Home</a></li><li class=nav-item><a class=nav-link href=/archives/index.html title=Archives>Archives</a></li><li class=nav-item><a class=nav-link href=/about/index.html title=About>About</a></li></ul><div class="col-12 col-xl-2 col-lg-3 col-md-4" id=main-nav-search><form class=input-group method=get accept-charset=UTF-8 action=//www.bing.com/search><input type=hidden name=q1 value=site:owent.net>
<input class=form-control type=text placeholder=搜索 name=q>
<button class="btn btn-outline-secondary my-0" type=submit>搜索</button></form></div></div></nav></div></div></header><div id=main><section id=main-content><div id=post-content><article id=post-309529f280e7884321ae82bd607c0f09 class="article-panel article article-type-post" itemscope itemprop=blogPost><div class="article-panel-inner article-inner"><div class=article-inner><header class=article-header><h1 itemprop=name><a class=article-title href=//owent.net/2025/2501.html target=_blank itemprop=url>通用RPC代码生成器</a></h1></header><hr><div id=toc class="well toc m-3 p-1 pr-1 pt-1 pb-2 float-md-right float-md-end"><nav id=TableOfContents><ul><li><a href=#背景>背景</a></li><li><a href=#使用上手文档>使用上手文档</a></li><li><a href=#设计文档>设计文档</a><ul><li><a href=#代码生成器引擎版本和配置>代码生成器引擎版本和配置</a></li><li><a href=#模板引擎语法参考>模板引擎语法参考</a></li><li><a href=#cmake接口>CMake接口</a></li><li><a href=#技术白皮书>技术白皮书</a></li><li><a href=#自动注入的模板变量和接口>自动注入的模板变量和接口</a></li><li><a href=#中间配置结构>中间配置结构</a></li></ul></li><li><a href=#最后>最后</a></li></ul></nav><div class="ads-placeholder ads-container"><ins class="adsbygoogle ads_toc" style=display:block data-ad-client=ca-pub-8180054975285991 data-ad-slot=1249494377 data-ad-format="rectangle, vertical" data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><br><div class=article-entry itemprop=articleBody><h2 id=背景>背景</h2><p>我们项目组需要接入多种RPC接入和工具转换流程，并且每种接入层有自己的扩展和定制需求。为了提高开发效率，我们需要一个通用的RPC代码生成器，能够支持多种RPC接入层级的代码生成，同时支持自定义插件和模板。并且自由增加自定义插件而不需要变更构建系统流程。以便提供最佳的灵活性且能支持protobuf的所有特性。</p><h2 id=使用上手文档>使用上手文档</h2><p>目前仅提供了Jinja2模板引擎的cmake接口封装（service-rpc层级），如果有需要Mako模板引擎封装接口或者增加message-field层级、enum-enumvalue层级、fileset-file层级或者global层级的接口入口可以联系 @owentou 。</p><p>首先添加Proto查找路径：</p><pre><code class=language-cmake>generate_for_pb_add_proto_path(&quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/private&quot;
                               &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/public&quot;)
</code></pre><p>添加Proto：</p><pre><code class=language-cmake>generate_for_pb_add_proto_file(
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/private/protocol/extension/svr.*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/private/protocol/common/svr.*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/private/protocol/config/svr.*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/private/protocol/pbdesc/svr.*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/public/protocol/extension/*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/public/protocol/common/*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/public/protocol/config/*.proto&quot;
  &quot;${PROJECT_SERVER_FRAME_PROTOCOL_DIR}/public/protocol/pbdesc/*.proto&quot;)
</code></pre><p>（可选）注册服务器间通信服务:</p><pre><code class=language-cmake>generate_for_pb_add_ss_service(
  &quot;${PROJECT_NAMESPACE}.LogicCommonService&quot;
  &quot;${CMAKE_CURRENT_LIST_DIR}/server_frame&quot;
  TASK_PATH_PREFIX &quot;logic&quot;
  HANDLE_PATH_PREFIX &quot;logic&quot;
  PROJECT_NAMESPACE &quot;${PROJECT_NAMESPACE}&quot;
  SERVICE_DLLEXPORT_DECL SERVER_FRAME_API
  RPC_DLLEXPORT_DECL SERVER_FRAME_API)
</code></pre><p>（可选）注册CS通信服务和CS协议模拟工具接口:</p><pre><code class=language-cmake># 注册CS通信服务
generate_for_pb_add_cs_service(
  &quot;${PROJECT_NAMESPACE}.GameClientService&quot;
  &quot;${CMAKE_CURRENT_LIST_DIR}/gamesvr&quot;
  RPC_IGNORE_EMPTY_REQUEST
  TASK_PATH_PREFIX &quot;logic&quot;
  HANDLE_PATH_PREFIX &quot;app&quot;
  PROJECT_NAMESPACE &quot;${PROJECT_NAMESPACE}&quot;
  SERVICE_DLLEXPORT_DECL GAMECLIENT_SERVICE_API
  RPC_DLLEXPORT_DECL GAMECLIENT_RPC_API)

# 注册CS协议模拟工具接口
generate_for_pb_add_simulator_cs_api(
  &quot;${PROJECT_NAMESPACE}.GameClientService&quot;
  &quot;${CMAKE_CURRENT_LIST_DIR}/tools/simulator&quot;
  RPC_IGNORE_EMPTY_REQUEST
  PROJECT_NAMESPACE &quot;${PROJECT_NAMESPACE}&quot;
  SERVICE_DLLEXPORT_DECL GAMECLIENT_SERVICE_API
  RPC_DLLEXPORT_DECL GAMECLIENT_RPC_API)
</code></pre><p>（可选）注册自定义配置</p><pre><code class=language-cmake>generate_for_pb_add_custom_configure(
  &quot;
# ${PROJECT_NAMESPACE}.ace.AntiCheatExpertService
- service:
    name: '${PROJECT_NAMESPACE}.ace.AntiCheatExpertService'
    overwrite: false
    output_directory: '${CMAKE_CURRENT_LIST_DIR}/sdk'
    service_dllexport_decl: 'ACE_SERVICE_API'
    rpc_dllexport_decl: 'ACE_SDK_API'
    custom_variables:
      project_namespace: '${PROJECT_NAMESPACE}'
      include_headers: [ ]
    service_template:
      - overwrite: true
        input: '${GENERATE_FOR_PB_SOURCE_DIR}/templates/ace_http_apis.h.mako'
        output: 'include/rpc/ace/ace_http_apis.h'
      - overwrite: true
        input: '${GENERATE_FOR_PB_SOURCE_DIR}/templates/ace_http_apis.cpp.mako'
        output: 'src/rpc/ace/ace_http_apis.cpp'&quot;)
</code></pre><p>最后执行启动生成:</p><pre><code class=language-cmake># Run generator finally
generate_for_pb_run_generator()
</code></pre><p>模板内自动注入的变量参见下面 <a href=#%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%8F%98%E9%87%8F%E5%92%8C%E6%8E%A5%E5%8F%A3>自动注入的模板变量和接口</a> 章节。</p><p>模板引擎语法参见下面 <a href=#%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E8%AF%AD%E6%B3%95%E5%8F%82%E8%80%83>模板引擎语法参考</a> 章节。</p><p>CMake接口说明参见下面 <a href=#CMake%E6%8E%A5%E5%8F%A3>CMake接口</a> 章节。</p><h2 id=设计文档>设计文档</h2><h3 id=代码生成器引擎版本和配置>代码生成器引擎版本和配置</h3><p>目前 <strong>通用RPC代码生成器</strong> 有两个版本:</p><ul><li>Jinja2模板引擎: <a href=https://github.com/atframework/atsf4g-co/blob/main/src/tools/generate-for-pb/jinja2-generator.py>src/tools/generate-for-pb/jinja2-generator.py</a><ul><li>CMake变量: <code>${GENERATE_FOR_PB_JINJA2_PY}</code></li></ul></li><li>Mako模板引擎: <a href=https://github.com/atframework/atsf4g-co/blob/main/src/tools/generate-for-pb/mako-generator.py>src/tools/generate-for-pb/mako-generator.py</a><ul><li>对应CMake变量: <code>${GENERATE_FOR_PB_MAKO_PY}</code></li></ul></li><li>中间配置参考: <a href=https://github.com/atframework/atsf4g-co/blob/main/src/tools/generate-for-pb/generate-for-pb.conf.yaml>src/tools/generate-for-pb/generate-for-pb.conf.yaml</a></li></ul><blockquote><p>Mako模板引擎有更好的灵活性，可以自由引入Python的全部组件。Jinja2的限定比较严格，目前仅导入了 <code>os</code>,<code>re</code>,<code>sys</code>,<code>re</code> 几个系统组件。
如果需要增加的话需要改模板引擎脚本。</p></blockquote><h3 id=模板引擎语法参考>模板引擎语法参考</h3><ul><li>Jinja模板语法: <a href=https://jinja.palletsprojects.com/en/stable/templates/>https://jinja.palletsprojects.com/en/stable/templates/</a></li><li>Mako模板语法: <a href=https://docs.makotemplates.org/en/latest/>https://docs.makotemplates.org/en/latest/</a></li></ul><h3 id=cmake接口>CMake接口</h3><pre><code class=language-cmake># 添加Proto查找路径
generate_for_pb_add_proto_path([proto文件查找路径...])

# 添加Proto
generate_for_pb_add_proto_file([proto文件...])

# 添加自定义配置组(结构见中间配置结构的Rules部分)
generate_for_pb_add_custom_configure(&quot;YAML配置内容&quot;)

# 注册服务间通信服务
generate_for_pb_add_ss_service(&quot;服务名&quot; &quot;输出目录&quot;
  [RPC_IGNORE_EMPTY_REQUEST]        # 是否忽略 google.protobuf.Empty 类型请求
  [NO_RPC]                          # 不生成RPC模板
  [NO_SERVICE_TASK]                 # 不生成Service模板
  [TASK_PATH_PREFIX &lt;value&gt;]        # 输出的任务代码路径前缀
  [HANDLE_PATH_PREFIX &lt;value&gt;]      # 输出的handle注册代码路径前缀
  [PROJECT_NAMESPACE &lt;value&gt;]       # 项目命名空间
  [RPC_ROOT_DIR &lt;value&gt;]            # 输出的RPC模板渲染文件目录
  [SERVICE_DLLEXPORT_DECL &lt;value&gt;]  # Service模板符号导出宏
  [RPC_DLLEXPORT_DECL &lt;value&gt;]      # RPC模板符号导出宏
  [INCLUDE_HEADERS &lt;values...&gt;]     # 额外包含的头文件
)

# 注册CS通信服务
generate_for_pb_add_cs_service(&quot;服务名&quot; &quot;输出目录&quot;
  [RPC_IGNORE_EMPTY_REQUEST]        # 是否忽略 google.protobuf.Empty 类型请求
  [TASK_PATH_PREFIX &lt;value&gt;]        # 输出的任务代码路径前缀
  [HANDLE_PATH_PREFIX &lt;value&gt;]      # 输出的handle注册代码路径前缀
  [PROJECT_NAMESPACE &lt;value&gt;]       # 项目命名空间
  [SERVICE_DLLEXPORT_DECL &lt;value&gt;]  # Service模板符号导出宏
  [RPC_DLLEXPORT_DECL &lt;value&gt;]      # RPC模板符号导出宏
  [INCLUDE_HEADERS &lt;values...&gt;]     # 额外包含的头文件
)

# 注册CS协议模拟工具接口
generate_for_pb_add_simulator_cs_api(&quot;服务名&quot; &quot;输出目录&quot;
  [RPC_IGNORE_EMPTY_REQUEST]        # 是否忽略 google.protobuf.Empty 类型请求
  [PROJECT_NAMESPACE &lt;value&gt;]       # 项目命名空间
  [SERVICE_DLLEXPORT_DECL &lt;value&gt;]  # Service模板符号导出宏
  [RPC_DLLEXPORT_DECL &lt;value&gt;]      # RPC模板符号导出宏
  [INCLUDE_HEADERS &lt;values...&gt;]     # 额外包含的头文件
)

# 执行生成
generate_for_pb_run_generator()
</code></pre><p>还可以根据需要扩展更多的自定义服务流程</p><h3 id=技术白皮书>技术白皮书</h3><p>为了降低重复解析pb和建立符号表带来的CPU开销导致的流程缓慢。整个模板引擎的RPC流程尽量采用统一配置文件，加载多个pb file的方式。然后通过配置多组生成组来生成不同的服务和模板。</p><div class=bg-dark><p><img src=2501.01.png alt=2501.01.png></p></div><p>代码生成的层级分为两类，第一类是全局模板。对应配置中的 <code>- global:</code> 。另一类是层级模板，分为外层和里层。外层会对每个模板执行一次渲染，里层模板会对每个内部子结构分别做一次渲染。</p><ul><li>对于service模板，外层是service本身，里层是rpc。</li><li>对于message模板，外层是message本身，里层是每个字段。</li><li>对于enum模板，外层是enum本身，里层是每个枚举项。</li><li>对于fileset模板，外层是pb文件本身的描述，里层是每个文件。</li></ul><p>比如我们要对以下服务应用模板渲染:</p><pre><code class=language-proto>service FriendsvrService {
  option (atframework.service_options) = {
    module_name: &quot;friend_api&quot;
  };

  rpc get_all(SSFriendGetAllReq) returns (SSFriendGetAllRsp) {
    option (atframework.rpc_options) = {
      api_name: &quot;拉取好友信息&quot;
      router_rpc: true
      user_rpc: true
    };
  };

  rpc echo(SSFriendEchoReq) returns (SSFriendEchoRsp) {
    option (atframework.rpc_options) = {
      api_name: &quot;Benchmark接口-用于请求放大&quot;
      router_rpc: true
      user_rpc: true
    };
  };
}
</code></pre><p>对 <code>service.c.template</code> 输入 <code>FriendsvrService</code> 渲染输出一个文件 <code>friendsvr_service.c</code> ，然后对每个RPC分别应用 <code>rpc.c.template</code> 渲染除 <code>rpc_get_all.c</code> 和 <code>rpc_echo.c</code> 。
那么就是使用service模板， <code>service.c.template</code> 作为外层模板，<code>rpc.c.template</code> 作为内层模板。</p><p>显然这里我们输出的文件名也是根据外层或内层的结构动态生成的。所以我们的文件名输出也支持模板渲染参数。
这个例子里 <code>service.c.template</code> 的输出可以设置为 <code>{{ service.get_name_lower_rule() }}.c</code> 。<code>rpc.c.template</code> 的输出可以设置为 <code>rpc_{{ rpc.get_name_lower_rule() }}.c</code></p><p>所有的输出均会检查变更，未变更不写出。这样不会破坏编译缓存命中。</p><h3 id=自动注入的模板变量和接口>自动注入的模板变量和接口</h3><h4 id=全局模板>全局模板</h4><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;database&quot;: PbDatabase(), // PbDatabase 对象
    &quot;global_dllexport_decl&quot;: &quot;符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><h4 id=service模板>Service模板</h4><p>外层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;service&quot;: PbService(), // 对应的PbService对象
    &quot;rpcs&quot;: {&quot;rpc name&quot;: PbRpc()}, // Service内的rpc集合
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbService(), // service的别名
    &quot;service_dllexport_decl&quot;: &quot;Service模板符号导出宏&quot;,
    &quot;rpc_dllexport_decl&quot;: &quot;RPC模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><p>内层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;service&quot;: PbService(), // 对应的PbService对象
    &quot;rpcs&quot;: {&quot;rpc name&quot;: PbRpc()}, // Service内的rpc集合
    &quot;rpc&quot;: PbRpc(), // 当前渲染的rpc对象
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbRpc(), // rpc的别名
    &quot;service_dllexport_decl&quot;: &quot;Service模板符号导出宏&quot;,
    &quot;rpc_dllexport_decl&quot;: &quot;RPC模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><h4 id=message模板>Message模板</h4><p>外层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;message&quot;: PbMessage(), // 对应的PbMessage对象
    &quot;fields&quot;: {&quot;field name&quot;: PbField()}, // Message内的字段集合
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbMessage(), // message的别名
    &quot;message_dllexport_decl&quot;: &quot;Message模板符号导出宏&quot;,
    &quot;field_dllexport_decl&quot;: &quot;字段模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><p>内层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;message&quot;: PbMessage(), // 对应的PbMessage对象
    &quot;fields&quot;: {&quot;field name&quot;: PbField()}, // PbMessage内的字段集合
    &quot;field&quot;: PbField(), // 当前渲染的字段对象
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbField(), // field的别名
    &quot;message_dllexport_decl&quot;: &quot;Message模板符号导出宏&quot;,
    &quot;field_dllexport_decl&quot;: &quot;字段模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><h4 id=enum模板>Enum模板</h4><p>外层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;enum&quot;: PbEnum(), // 对应的PbEnum对象
    &quot;enumvalues&quot;: {&quot;enumvalue name&quot;: PbEnumValue()}, // Enum内的枚举项集合
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbEnum(), // enum的别名
    &quot;enum_dllexport_decl&quot;: &quot;Enum模板符号导出宏&quot;,
    &quot;enumvalue_dllexport_decl&quot;: &quot;Enum值模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><p>内层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;enum&quot;: PbEnum(), // 对应的PbEnum对象
    &quot;enumvalues&quot;: {&quot;enumvalue name&quot;: PbEnumValue()}, // PbEnum内的枚举项集合
    &quot;enumvalue&quot;: PbEnumValue(), // 当前渲染的枚举项对象
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbEnumValue(), // enumvalue的别名
    &quot;enum_dllexport_decl&quot;: &quot;Enum模板符号导出宏&quot;,
    &quot;enumvalue_dllexport_decl&quot;: &quot;Enum值模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><h4 id=fileset模板>FileSet模板</h4><p>内层模板参数:</p><pre><code class=language-javascript>{
    &quot;generator&quot;: &quot;代码生成器路径&quot;,
    &quot;local_vcs_user_name&quot;: &quot;当前操作者用户名&quot;,
    &quot;file_descriptor_set&quot;: PbDatabase(), // PbDatabase 对象
    &quot;files&quot;: {&quot;文件路径&quot;: PbFile()}, // PbEnum内的文件描述集合
    &quot;file&quot;: PbFile(), // 当前渲染的文件描述对象
    &quot;output_file_path&quot;: &quot;输出文件路径&quot;,
    &quot;output_render_path&quot;: &quot;输出文件路径渲染结果&quot;,
    &quot;current_instance&quot;: PbFile(), // file的别名
    &quot;file_dllexport_decl&quot;: &quot;文件模板符号导出宏&quot;,
    &quot;PbConvertRule&quot;: PbConvertRule // PbConvertRule里包含了一些命名转换定义
}
</code></pre><h4 id=python对象接口>Python对象接口</h4><pre><code class=language-python>class PbConvertRule:
    &quot;&quot;&quot;
    PbConvertRule is a class that defines constants for different naming conversion rules.

    Attributes:
        CONVERT_NAME_NOT_CHANGE (int): 不执行命名转换
        CONVERT_NAME_LOWERCASE (int): 命名风格转换： 转小写
        CONVERT_NAME_UPPERCASE (int): 命名风格转换： 转大写
        CONVERT_NAME_CAMEL_FIRST_LOWERCASE (int): 命名风格转换： 转首字母大写的驼峰式命名
        CONVERT_NAME_CAMEL_CAMEL (int): 命名风格转换： 转驼峰式命名
    &quot;&quot;&quot;
    CONVERT_NAME_NOT_CHANGE = 0
    CONVERT_NAME_LOWERCASE = 1
    CONVERT_NAME_UPPERCASE = 2
    CONVERT_NAME_CAMEL_FIRST_LOWERCASE = 3
    CONVERT_NAME_CAMEL_CAMEL = 4


class PbObjectBase(object):
    &quot;&quot;&quot;
    所有模板目标结构的基类.

    Attributes:
        descriptor: 原始的描述结构.
        refer_database: 指向 PbDatabase 结构，可以用这个访问其他描述信息.
    &quot;&quot;&quot;

    def __init__(self, descriptor, refer_database):
        pass

    &quot;&quot;&quot;
    输入标识符名字，按规则转换标识符名字

    Args:
        name: 输入标识符名字
        mode: 转换规则
        package_seperator: package分隔符

    Returns:
        转换后的标识符名字
    &quot;&quot;&quot;
    def get_identify_name(self, name, mode=PbConvertRule.CONVERT_NAME_LOWERCASE, package_seperator=&quot;.&quot;):
        pass

    &quot;&quot;&quot;
    输入标识符名字，转换成小写风格.

    Args:
        name: 输入标识符名字

    Returns:
        转换后的标识符名字
    &quot;&quot;&quot;
    def get_identify_lower_rule(self, name):
        pass

    &quot;&quot;&quot;
    输入标识符名字，转换成大写风格.

    Args:
        name: 输入标识符名字

    Returns:
        转换后的标识符名字
    &quot;&quot;&quot;
    def get_identify_upper_rule(self, name):
        pass

    &quot;&quot;&quot;
    获取小写风格的名字

    Returns:
        小写风格的名字
    &quot;&quot;&quot;
    def get_name_lower_rule(self):
        pass

    &quot;&quot;&quot;
    获取大写风格的名字

    Returns:
        小写风格的名字
    &quot;&quot;&quot;
    def get_name_upper_rule(self):
        pass

    &quot;&quot;&quot;
    获取插件对象

    Args:
        name: 插件名（完整路径）
        default_value: 找不到返回值

    Returns:
        插件对象或default_value
    &quot;&quot;&quot;
    def get_extension(self, name, default_value=None):
        pass

    &quot;&quot;&quot;
    获取插件字段对象

    Args:
        name: 插件名（完整路径）
        fn: 提取插件字段的函数
        default_value: 找不到返回值

    Returns:
        插件对象或default_value
    &quot;&quot;&quot;
    def get_extension_field(self, name, fn, default_value=None):
        pass

    &quot;&quot;&quot;
    是否有效
    &quot;&quot;&quot;
    def is_valid(self, ignore_request):
        pass

    &quot;&quot;&quot;
    获取原始name

    Returns:
        原始name
    &quot;&quot;&quot;
    def get_name(self):
        pass

    &quot;&quot;&quot;
    获取完整name

    Returns:
        完整name
    &quot;&quot;&quot;
    def get_full_name(self):
        pass

    &quot;&quot;&quot;
    获取C++类名

    Returns:
        C++类名
    &quot;&quot;&quot;
    def get_cpp_class_name(self):
        pass

    &quot;&quot;&quot;
    获取C++命名空间起始声明

    Args:
        full_name: 输入名字
        pretty_ident: 美化输出的缩进

    Returns:
        C++命名空间起始声明
    &quot;&quot;&quot;
    def get_cpp_namespace_begin(self, full_name, pretty_ident=&quot;&quot;):
        pass

    &quot;&quot;&quot;
    获取C++命名空间结束声明

    Args:
        full_name: 输入名字
        pretty_ident: 美化输出的缩进

    Returns:
        C++命名空间结束声明
    &quot;&quot;&quot;
    def get_cpp_namespace_end(self, full_name, pretty_ident=&quot;&quot;):
        pass

    &quot;&quot;&quot;
    获取C++命名空间代码前缀

    Args:
        full_name: 输入名字

    Returns:
        C++命名空间代码前缀
    &quot;&quot;&quot;
    def get_cpp_namespace_prefix(self, full_name):
        return &quot;::&quot;.join(HANDLE_SPLIT_MODULE_RULE.split(full_name))

    &quot;&quot;&quot;
    获取package

    Returns:
        package
    &quot;&quot;&quot;
    def get_package(self):
        return self.descriptor.file.package


class PbFile(PbObjectBase):

    &quot;&quot;&quot;
    获取去除后缀之后的文件路径

    Returns:
        去除后缀之后的文件路径
    &quot;&quot;&quot;
    def get_file_path_without_ext(self):
        full_name = self.get_full_name()
        if full_name.endswith(&quot;.proto&quot;):
            return full_name[:-len(&quot;.proto&quot;)]
        return full_name

class PbField(PbObjectBase):
    pass

class PbOneof(PbObjectBase):
    &quot;&quot;&quot;
    Oneof结构表述.

    Attributes:
        file: 所属 PbFile
        container: 所属 PbMessage
        fields: 包含字段 ([PbField])
        fields_by_name: 包含字段,名字集合 (PbField)
        fields_by_number: 包含字段,Field Number集合 (PbField)
    &quot;&quot;&quot;
    pass

class PbMessage(PbObjectBase):
    &quot;&quot;&quot;
    Message 结构表述.

    Attributes:
        file: 所属 PbFile
        fields: 包含字段 ([PbField])
        fields_by_name: 包含字段,名字集合 (PbField)
        fields_by_number: 包含字段,Field Number集合 (PbField)
        oneofs: 包含oneof(PbOneof)
        oneofs_by_name: 包含oneof,名字集合 (PbOneof)
    &quot;&quot;&quot;
    pass

class PbEnumValue(PbObjectBase):
    &quot;&quot;&quot;
    Enum枚举项结构表述.

    Attributes:
        file: 所属 PbFile
        container: 包含Enum (PbEnum)
    &quot;&quot;&quot;
    pass


class PbEnum(PbObjectBase):
    &quot;&quot;&quot;
    Enum枚举项结构表述.

    Attributes:
        file: 所属 PbFile
        values: 包含字段 ([PbField])
        values_by_name: 包含字段,名字集合 (PbField)
        values_by_number: 包含字段,Field Number集合 (PbField)
    &quot;&quot;&quot;
    pass


class PbRpc(PbObjectBase):
    &quot;&quot;&quot;
    RPC结构表述.

    Attributes:
        file: 所属 PbFile
        service: 所属 Service ([PbService])
    &quot;&quot;&quot;

    &quot;&quot;&quot;
    获取所属的Service

    Returns:
        所属的Service
    &quot;&quot;&quot;
    def get_service(self):
        return self.service

    &quot;&quot;&quot;
    获取请求结构描述

    Returns:
        请求结构描述
    &quot;&quot;&quot;
    def get_request(self):
        pass

    &quot;&quot;&quot;
    获取请求结构原始类型描述

    Returns:
        请求结构原始类型描述
    &quot;&quot;&quot;
    def get_request_descriptor(self):
        return self.get_request().descriptor

    &quot;&quot;&quot;
    获取请求结构插件

    Args:
        name: 插件名
        default_value: 找不到返回默认值

    Returns:
        插件或default_value
    &quot;&quot;&quot;
    def get_request_extension(self, name, default_value=None):
        pass

    &quot;&quot;&quot;
    获取回包结构描述

    Returns:
        回包结构描述
    &quot;&quot;&quot;
    def get_response(self):
        pass

    &quot;&quot;&quot;
    获取回包结构原始类型描述

    Returns:
        回包结构原始类型描述
    &quot;&quot;&quot;
    def get_response_descriptor(self):
        return self.get_response().descriptor

    &quot;&quot;&quot;
    获取回包结构插件

    Args:
        name: 插件名
        default_value: 找不到返回默认值

    Returns:
        插件或default_value
    &quot;&quot;&quot;
    def get_response_extension(self, name, default_value=None):
        pass

    &quot;&quot;&quot;
    获取请求是否是流式

    Returns:
        请求是否是流式
    &quot;&quot;&quot;
    def is_request_stream(self):
        pass

    &quot;&quot;&quot;
    获取回包是否是流式

    Returns:
        回包是否是流式
    &quot;&quot;&quot;
    def is_response_stream(self):
        pass


class PbService(PbObjectBase):
    &quot;&quot;&quot;
    Service结构表述.

    Attributes:
        file: 所属 PbFile
        rpcs: 包含的RPC集合，名字为Key (PbRpc)
    &quot;&quot;&quot;


class PbDatabase(object):
    &quot;&quot;&quot;
    符号数据库.

    Attributes:
        raw_files: 包含的原始file描述集合
        raw_symbols: 包含的原始符号表描述
        default_factory: 初始注册表工厂（第一次建库，无自定义插件）
        extended_factory: 扩展注册表工厂（第二次建库，包含自定义插件）
    &quot;&quot;&quot;

    &quot;&quot;&quot;
    加载pb文件

    Args:
        pb_file_path: 基础pb文件
        external_pb_files: 依赖pb文件列表

    Returns:
        插件或default_value
    &quot;&quot;&quot;
    def load(self, pb_file_path, external_pb_files):
        pass

    &quot;&quot;&quot;
    获取原始file描述集合

    Returns:
        获取原始file描述集合
    &quot;&quot;&quot;
    def get_raw_file_descriptors(self):
        pass

    &quot;&quot;&quot;
    获取原始符号描述

    Args:
        full_name: 符号完整名称

    Returns:
        原始符号描述
    &quot;&quot;&quot;
    def get_raw_symbol(self, full_name):
        pass

    &quot;&quot;&quot;
    获取PbFile

    Args:
        name: 路径

    Returns:
        PbFile
    &quot;&quot;&quot;
    def get_file(self, name):
        pass

    &quot;&quot;&quot;
    获取PbService

    Args:
        full_name: 完整名称

    Returns:
        PbFile
    &quot;&quot;&quot;
    def get_service(self, full_name):
        pass

    &quot;&quot;&quot;
    获取PbMessage

    Args:
        full_name: 完整名称

    Returns:
        PbMessage
    &quot;&quot;&quot;
    def get_message(self, full_name):
        pass

    &quot;&quot;&quot;
    获取PbEnum

    Args:
        full_name: 完整名称

    Returns:
        PbMessage
    &quot;&quot;&quot;
    def get_enum(self, full_name):
        pass

    &quot;&quot;&quot;
    获取原始插件结构

    Args:
        full_name: 完整名称

    Returns:
        PbMessage
    &quot;&quot;&quot;
    def get_extension(self, full_name):
        pass
</code></pre><h3 id=中间配置结构>中间配置结构</h3><pre><code class=language-yaml># 全局配置
configure:
  # 输出文件编码
  encoding: &quot;UTF-8&quot;
  # 默认输出目录
  output_directory: &quot;output directory&quot;
  # 默认是否覆盖已存在文件
  overwrite: false # overwrite file if it's already exists
  # 额外的Python PATH
  paths: []
  # 额外的Python包路径
  package_prefix: []
  # protoc 路径（使用传入的pb时这个可以不用）
  protoc: &quot;path of protobuf protoc&quot;
  # protoc 执行参数（使用传入的pb时这个可以不用）
  protoc_flags: []
  # protoc 执行包含目录（使用传入的pb时这个可以不用）
  protoc_includes: []
  # protoc 执行的 .proto 文件（使用传入的pb时这个可以不用）
  protocol_files: []
  # 输入的 .pb 文件
  protocol_input_pb_file: &quot;path of input pb file&quot;
  # 如果执行了protoc，输出文件位置
  protocol_output_pb_file: &quot;path of output pb file&quot;
  # 工程目录
  protocol_project_directory: &quot;path of project&quot;
  # 额外的依赖pb文件列表
  protocol_external_pb_files: [] # external pb fils to load
  # 自定义注入参数
  custom_variables:
    key: &quot;value&quot; # custom variables of &quot;key&quot;

# 规则列表，内含多个规则
rules:
  # 全局模板
  - global:
      # 是否覆盖已存在文件
      overwrite: false # overwrite configure.overwrite
      # 输出目录
      output_directory: &quot;overwrite configure.output_directory&quot;
      # 自定义注入参数
      custom_variables:
        key: &quot;value&quot; # overwrite configure.custom_variables.key
      # 输入的模板路径
      input: &quot;input template path&quot;
      # 输出的文件规则
      output: &quot;output path rule&quot;
  # Service模板
  - service:
      # Service完整名称
      name: &quot;service name&quot;
      # 默认是否覆盖已存在文件
      overwrite: false # overwrite configure.overwrite
      # 默认输出目录
      output_directory: &quot;overwrite configure.output_directory&quot;
      # 自定义注入参数
      custom_variables:
        key: &quot;value&quot; # overwrite configure.custom_variables.key
      # 外层模板： service
      service_template:
        # 是否覆盖已存在文件
        - overwrite: false
          # 输入的模板路径
          input: &quot;input template path&quot;
          # 输出的文件规则
          output: &quot;output path rule&quot;
      # 内层模板： rpc
      rpc_template:
        - overwrite: false
          input: &quot;input template path&quot;
          output: &quot;output path rule&quot;
      # 内存模板的包含规则（正则表达式）
      rpc_include: &quot;regex rule&quot;
      # 内存模板的排除规则（正则表达式）
      rpc_exclude: &quot;regex rule&quot;
      # 按请求类型忽略RPC（内层模板）
      rpc_ignore_request: [] # ignore request types for rpc template
  # Message模板，结构和上面类似，不再复述
  - message:
      # Message完整名称
      name: &quot;message name&quot;
      overwrite: false # overwrite configure.overwrite
      output_directory: &quot;overwrite configure.output_directory&quot;
      custom_variables:
        key: &quot;value&quot; # overwrite configure.custom_variables.key
      message_template:
        - overwrite: false
          input: &quot;input template path&quot;
          output: &quot;output path rule&quot;
      field_template:
        - overwrite: false
          input: &quot;input template path&quot;
          output: &quot;output path rule&quot;
      field_include: &quot;regex rule&quot;
      field_exclude: &quot;regex rule&quot;
      # 按字段类型忽略RPC（内层模板）
      field_ignore_type: [] # ignore types for field template
  # Enum模板，结构和上面类似，不再复述
  - enum:
      # Enum完整名称
      name: &quot;enum name&quot;
      overwrite: false # overwrite configure.overwrite
      output_directory: &quot;overwrite configure.output_directory&quot;
      custom_variables:
        key: &quot;value&quot; # overwrite configure.custom_variables.key
      enum_template:
        - overwrite: false
          input: &quot;input template path&quot;
          output: &quot;output path rule&quot;
      value_template:
        - overwrite: false
          input: &quot;input template path&quot;
          output: &quot;output path rule&quot;
      value_include: &quot;regex rule&quot;
      value_exclude: &quot;regex rule&quot;
  # 文件集（.pb文件）模板，结构和上面类似，不再复述
  - file:
      overwrite: false # overwrite configure.overwrite
      output_directory: &quot;overwrite configure.output_directory&quot;
      custom_variables:
        key: &quot;value&quot; # overwrite configure.custom_variables.key
      # file_template 是内层模板，文件集没有外层模板
      file_template:
        - overwrite: false
          input: &quot;input template path&quot;
          output: &quot;output path rule&quot;
      file_include: &quot;regex rule&quot;
      file_exclude: &quot;regex rule&quot;
      # 按package忽略file
      file_ignore_package: [] # ignore files by package
</code></pre><h2 id=最后>最后</h2><p>工具和代码开源在 <a href=https://github.com/atframework/atsf4g-co/blob/main/src/generate_for_pb_utility.cmake>https://github.com/atframework/atsf4g-co/blob/main/src/generate_for_pb_utility.cmake</a> 和 <a href=https://github.com/atframework/atsf4g-co/tree/main/src/tools/generate-for-pb>https://github.com/atframework/atsf4g-co/tree/main/src/tools/generate-for-pb</a> 。
欢迎有兴趣的同学互相交流。</p></div><hr><footer class=article-footer><div class="article-panel-footer article-meta article-footer clearfix"><span class=article-meta-left><ol><li><a href=//owent.net/categories/article.html>Article</a></li><li><a href=//owent.net/categories/blablabla.html>Blablabla</a></li></ol></span><span class=article-meta-right><time datetime=2025-02-13T17:06:45.000+00:00 itemprop=datePublished>2025-02-13</time></span>
<span class=clearfix></span></div><div class=article-tags><ul class=article-tag-list><li class=article-tag-list-item><a href=//owent.net/tags/mako.html>mako</a></li><li class=article-tag-list-item><a href=//owent.net/tags/jinja2.html>jinja2</a></li><li class=article-tag-list-item><a href=//owent.net/tags/rpc.html>rpc</a></li><li class=article-tag-list-item><a href=//owent.net/tags/%E6%A8%A1%E6%9D%BF.html>模板</a></li><li class=article-tag-list-item><a href=//owent.net/tags/%E7%94%9F%E6%88%90%E5%99%A8.html>生成器</a></li><li class=article-tag-list-item><a href=//owent.net/tags/generator.html>generator</a></li><li class=article-tag-list-item><a href=//owent.net/tags/service.html>service</a></li><li class=article-tag-list-item><a href=//owent.net/tags/rpc.html>rpc</a></li></ul></div></footer><div class="ads-placeholder ads-container"><ins class="adsbygoogle ads_infeed" style=display:block data-ad-client=ca-pub-8180054975285991 data-ad-slot=5599802929 data-ad-format="rectangle, horizontal" data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><hr><nav id=article-nav><ul class=pagination><li class=page-item><a class=page-link id=article-nav-newer class=article-nav-link-wrap href=//owent.net/2025/2502.html>上一篇<strong>协程(libcopp)的Channel功能和CPU命中率优化</strong></a></li><li class=page-item><a class=page-link id=article-nav-older class=article-nav-link-wrap href=//owent.net/2024/2405.html>下一篇<strong>实现strong_rc_ptr(比shared_ptr更快的引用计数智能指针)</strong></a></li></ul></nav><hr><script src=https://utteranc.es/client.js repo=owent/blog-website issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></article></div></section></div><footer id=footer><div class=outer><div id=footer-info class="inner clearfix"><strong id=footer-left class="float-left float-start"><a rel=license href=https://github.com/owent/blog-hugo/blob/master/LICENSE.md><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>2025&nbsp;owent
</strong><strong id=footer-right class="float-right float-end"><a href=https://beian.miit.gov.cn/ target=_blank>沪ICP备2022003252号</a>&nbsp;&nbsp;<a href=https://github.com/owent/blog-hugo target=_blank>本站源码</a>,
发布者 <a href=https://gohugo.io/ target=_blank>Hugo</a>,
主题 <a href=https://github.com/owent/hugo-theme-distinctionpp target=_blank>distinctionpp</a>
</strong><span class=clearfix></span></div></div></footer></div><script type=module>// import * as Popper from "@popperjs/core";// import * as bootstrap from "bootstrap";
// import React from "react";

        
</script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/accesslog.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/armasm.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/awk.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/basic.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/bnf.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/capnproto.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/cmake.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/d.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/dockerfile.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/dos.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/erlang.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ebnf.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/latex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/llvm.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/lua.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/powershell.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/protobuf.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/profile.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/vim.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/x86asm.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/yaml.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/vs2015.min.css",document.querySelector("head").appendChild(t),window.JSON?hljs.configure(JSON.parse('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}')):hljs.configure(evel('{"ignoreunescapedhtml":true,"languages":{},"tabreplace":"    ","throwunescapedhtml":false,"usebr":false}'));const n={};for(const e of hljs.listLanguages())n[e.toLowerCase()]=!0;for(const e of document.querySelectorAll("pre>code"))try{if(e.className.match(/\bmermaid\b/i)){e.classList.add("mermaid");continue}if(e.className.match(/\bnohighlight\b/i))continue;const t=e.className.match(/language-([^\s]+)/i);if(t&&t.length>=2&&hljs.getLanguage(t[1]))hljs.highlightElement(e);else{const t=hljs.highlightAuto(e.innerText,hljs.listLanguages());t&&t.value&&(e.innerHTML=t.value,e.classList.add("hljs"))}}catch(e){window.console&&console.log(e.toString()+`\r
Maybe can not detect the language`)}})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-PQEY77BYG1"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-PQEY77BYG1")}</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",e=>{const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css",document.querySelector("head").appendChild(t),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1},{left:"$",right:"$",display:!1}],throwOnError:!1,ignoredTags:["script","noscript","style","textarea","pre","code"]})})</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js></script><script type=module>
import mermaid from "mermaid";
const config = {
    theme: 'neutral',
    logLevel: 'fatal',
    securityLevel: 'loose', 
    startOnLoad: true,
    arrowMarkerAbsolute: false,
    

};
mermaid.initialize(config);
</script><script type=text/javascript>var _hmt=_hmt||[];(function(){var t,n,e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?6a0daf8d58889f1cf55a353867bfdbb0",t=document.getElementsByTagName("script"),n=document.getElementsByTagName("script")[t.length-1],n.parentNode.appendChild(e)})()</script></div></body></html>